mcscf模块
================================================
多组态自洽场计算模块，如果没有定义活性空间，则进行二阶收敛的RHF计算。如果不优化分子轨道，仅进行CASCI计算。

:guilabel:`AutoMC` 参数类型：Bool型
------------------------------------------------
当用户显式设置 $expandmo 模块以启用活性空间自动选择时，
采用此关键词，BDF将自动生成关键词``close``，``active``，``actel``的值。

.. attention::
 用户输入优先级: 若用户在后续输入文件中手动设置``close``、``active``、``actel`` 等关键词，用户自定义值将覆盖系统自动生成值。

:guilabel:`Core` 参数类型：整型数组
------------------------------------------------
指定每个不可约表示的冻结双占据轨道数目。

:guilabel:`Delete` 参数类型：整型数组
---------------------------------------------------
指定每个不可约表示的冻结虚轨道。冻结轨道不参与轨道优化。

:guilabel:`Close` 参数类型：整型数组
------------------------------------------------
指定每个不可约表示的非活性双占据轨道。

:guilabel:`Active` 参数类型：整型数组
------------------------------------------------
指定每个不可约表示的活性轨道数目。

:guilabel:`Actel` 参数类型：整型
---------------------------------------------------
指定活性空间的电子数。

:guilabel:`RootPrt` 参数类型：整型数组
------------------------------------------------
指定选择MCSCF的那个根计算数值梯度。

:guilabel:`Symmetry` 参数类型：整型
------------------------------------------------
指定MCSCF计算电子态的对称性。

:guilabel:`Spin` 参数类型：整型
---------------------------------------------------
指定MCSCF计算电子态的自旋，2S+1。

:guilabel:`Roots` 参数类型：整型数组
------------------------------------------------
roots是多行参数，指定MCSCF计算多少个根，如何态平均。根据计算的跟的数目，输入需要1或3行：
第一行：2到3个整数“n m i”，第一个整数“n”指定对多少个根做态平均；第二个整数“m”指定CI计算多少个根，n<=m； 第三个整数是控制参数，如果输入第三个整数为1，这无需额外的两行输入，直接对“n”个最低态做态平均；如果第三个整数未输入或输入0，这需要输入额外两行指定如何做态平均。
第二行：指定对那些根做态平均。
第三行：指定做态平均的根的权重，程序会自动归一化权重。

.. code-block:: python

     $MCSCF
     ...
     Roots
     3 4        # 对3个根做态平均，CI计算4个根
     1 2 4      # 对第1、2、4三个态做态平均
     1 1 1      # 每个态的权重相同
     $End

.. code-block:: python

     $MCSCF
     ...
     Roots
     3 4 1   # 对3个根做态平均，CI计算4个根
     $End

:guilabel:`MixCI` 参数类型：整型数组
---------------------------------------------------
MixCI是多行参数，参数控制对多个不同自旋多重度和对称性的电子态做态平均。需要四行输入。
第一行，整数“n”指定平均多少种不同自旋多重度和对称性的态。
第二行，每种态的自旋旋 多重度的。
第三行，每种态的数目。
第四行，每种态的空间对称性。

.. code-block:: python

     $MCSCF
     ....
     MixCI  
      3       # 3种不同对称性的电子态
     1 3 5     # 自旋多重度分别为单重态、三重态和五重态
     3 1 2     # 每种态分别平均3、1、2个根
     1 4 3     # 每种态分数不可约表示1、4、3
     $End

:guilabel:`Guess` 参数类型：字符串
---------------------------------------------------
可选值：hcore、huckel、hforb、mcorb、Inporb

指定MCSCF的初始猜测轨道。
hcore: 单电子哈密顿的解作为初始猜测。
huckel: 扩展的Huckel方法猜测
hforb： 读入bdftask.hforb作为初始猜测，由SCF计算产生
mcorb:  读入bdftask.mcorb作为初始猜测，有MCSCF计算产生
Inporb: 读入inporb作为初始猜测，inporb为文本格式，一般来自SCF或者MCSCF计算的文本格式输出的轨道。

:guilabel:`Guga` 参数类型：Bool型
------------------------------------------------
指定采用GUGA算法计算CASCI。默认采用TUGA算法。

:guilabel:`iCI` 参数类型：Bool型
------------------------------------------------
指定采用iCI方法作为CASCI求解器。但不提供iCI与CASCI偏差的ENPT2修正项。这就是iCISCF方法。

:guilabel:`iCIPT2` 参数类型：Bool型
------------------------------------------------
指定采用iCI方法作为CASCI求解器。同时提供iCI与CASCI偏差的ENPT2修正项。这就是iCISCF(2)方法。

:guilabel:`CVS` 参数类型：Bool型
------------------------------------------------
指定采用GUGA方法计算核电子激发（core excitations）。

:guilabel:`Actfrz` 参数类型：整型
---------------------------------------------------
冻结活性空间内实际为核心轨道（core orbitals）的分子轨道（MOs），可用于计算核电子激发（core excitations）。

输入格式规则: 
第1行: 声明需冻结的活性MOs数量（正整数）。
第2行: 列出被冻结MOs的索引序号（需符合程序输入规范）。

.. code-block:: bdf

 $mcscf
 ...
 actfrz
 3
 10 11 12  ! these three MOs are core orbitals 
 $end

:guilabel:`SOCCAS` 参数类型：Bool型
------------------------------------------------
指定采用TUGA计算SOiCISCF。

:guilabel:`SOCene` 参数类型：Bool型
------------------------------------------------
指定采用GUGA计算MCSCF所涉及的电子态之间的SOC。

:guilabel:`XvrSet` 参数类型：整型数组
------------------------------------------------
设置通过expandmo生成的MCSCF的每个不可约表示的扩展虚轨道（XVR）轨道。
需与expandmo模块的``VSD``关键词联用，用于定义XVR的初始化配置。

.. attention::
 指定MCSCF轨道排序规则:
 强制轨道按 双占据（Closed）→ 活性（Active）→ 虚轨道（Vir）→ XVR 的顺序排列。

* 完整输入逻辑参见示例：test126.inp

:guilabel:`Virdel` 参数类型：Bool型
------------------------------------------------
指定强制轨道按 双占据（Closed）→ 活性（Active）→ 虚轨道（Vir）→ XVR 的顺序排列。

* 完整输入逻辑参见示例：test126.inp

:guilabel:`XvrUse` 参数类型：Bool型
------------------------------------------------
指定将MCSCF计算生成的扩展虚轨道（XVR）输出至检查点文件（chkfil），供后续xianci模块调用。
启用此关键词时，程序将保留XVR轨道而非默认的删除操作，实现跨模块数据复用。

.. note::
若未启用XvrUse，xianci模块将自动删除临时XVR并重新计算。

* 完整输入逻辑参见示例：test126.inp

:guilabel:`Solvate` 参数类型：Bool型
------------------------------------------------
指定考虑溶剂化效应的MCSCF计算。
.. note:: 
   所用溶剂、溶剂化模型、参数等都源自前面的SCF计算。

:guilabel:`Sortact` 参数类型：整型
------------------------------------------------
指定活性空间轨道排序功能。

输入格式:
第1行：指定排序对数量（整数）。
第2行：按顺序列出需移入活性空间的分子轨道(MO)索引。
第3行：按顺序列出需移出活性空间的分子轨道(MO)索引，与第2行的索引一一配对交换。

.. code-block:: bdf

 $mcscf
 ...
 SortAct  
 3  
 10 15 20   # 表示将MO 10、15、20移入活性空间  
 12 13 14   # 对应的MO 12、13、14将被移出活性空间 
 $end

.. note:: 

 上述示例中实际执行三组MO交换操作：
 MO 10 ↔ MO 12、MO 15 ↔ MO 13、MO 20 ↔ MO 14
 索引编号通常基于计算输出文件中的轨道排序（建议优先查看Output或Molden文件中的MO列表）。

应用场景:
在CASSCF计算中手动调整活性轨道组成。调整多参考态计算的轨道空间分布，修复因轨道编号错位导致的收敛问题

:guilabel:`grad` 参数类型：Bool型
------------------------------------------------
指定计算并存储解析梯度计算所需要的分子轨道积分与轨道Hessian矩阵。
当用grad模块计算MCSCF解析梯度时，须在mcscf模块添加此关键词。

:guilabel:`iCAS` 参数类型：Bool型
------------------------------------------------
指定采用iCAS方法对MCSCF每步宏迭代进行活性空间强制验证。

* 功能描述: 通过MOM/SVD/Hungary算法验证双占据、活性及虚空间划分，并强制构建CAS活性空间。
* 默认使用MOM方法，用户需显式设置关键词``Hungary``或``SVD``以调用替代算法。

:guilabel:`SVD` 参数类型：Bool型
------------------------------------------------
指定SVD算法验证双占据、活性及虚空间划分。

:guilabel:`Hungary` 参数类型：Bool型
------------------------------------------------
指定Hungary算法验证双占据、活性及虚空间划分。

:guilabel:`Actadd` 参数类型：Bool型
------------------------------------------------
功能描述: 当该关键词与iCAS或SVD联用进行活性空间校验时，程序将自动扩大活性轨道数以优化空间划分。

触发条件:
1. 与iCAS联用时，根据轨道占据涨落自动补充近简并轨道。
2. 与SVD（奇异值分解）联用时,通过矩阵秩分析动态扩展轨道空间维度。

:guilabel:`Statemo` 参数类型：整型
------------------------------------------------
指定态指定分子轨道输出。

* 功能描述: 设置需输出态指定分子轨道的态编号。
* 默认值: StateMO = 0表示输出态平均分子轨道。

:guilabel:`Qcmo` 参数类型：Bool型
------------------------------------------------
指定CASSCF计算生成准正则活性分子轨道。CASSCF默认生成自然活性轨道。

:guilabel:`Direct` 参数类型：Bool型
------------------------------------------------
指定每次MCSCF迭代做一次直接CI。

:guilabel:`Molden` 参数类型：Bool型
---------------------------------------------------
输出MCSCF优化得到的分子轨道至$BDFTASK.mcscf.molden文件。

:guilabel:`Iprtmo` 参数类型：整型
------------------------------------------------
指定打印MO的级别。同SCF中的相关参数。

:guilabel:`CASCI` 参数类型：Bool型
------------------------------------------------
指定只做CI计算，不优化分子轨道。

:guilabel:`cionly` 参数类型：Bool型
------------------------------------------------
指定只做CI计算，不优化分子轨道。等价于关键词``CASCI``。

:guilabel:`orbonly` 参数类型：Bool型
------------------------------------------------
指定只优化分子轨道，不做CI计算。

:guilabel:`CIread` 参数类型：Bool型
---------------------------------------------------
指定读入CI波函数作为CI计算的初始猜测波函数。

**定域MCSCF相关参数**

:guilabel:`Localmc` 
------------------------------------------------
指定定域化MCSCF优化得到的分子轨道。

:guilabel:`Nolmocls` 参数类型：Bool型
------------------------------------------------
指定不定域化MCSCF生成的双占据轨道。

:guilabel:`Nolmoact` 参数类型：Bool型
------------------------------------------------
指定不定域化MCSCF生成的活性轨道。

:guilabel:`Nolmovir` 参数类型：Bool型
------------------------------------------------
指定不定域化MCSCF生成的虚轨道。

:guilabel:`Nature` 
------------------------------------------------
指定CASSCF计算生成自然活性分子轨道。此为默认输出活性轨道。

:guilabel:`Mom` 
------------------------------------------------
指定MOM算法验证双占据、活性及虚空间划分。此为默认方法。

**MCSCF轨道优化算法控制**

:guilabel:`Quasi` 参数类型：Bool型
------------------------------------------------
指定使用准牛顿法MCSCF。

:guilabel:`Superci` 参数类型：Bool型
------------------------------------------------
指定使用Super-CI-PT 计算准牛顿法所需轨道Hessian矩阵对角元。此关键词用于替代``Quasi``。
此关键词所需分子轨道积分为(pw|uv)小于关键词``Quasi``的(pq|uv)，多用于原子轨道超过1500的分子体系。

.. attention::
  此方法的近似较大，可能导致MCSCF计算无法收敛。若出现此情况，请重新选择更为合理的活性空间。

:guilabel:`Werner` 参数类型：Bool型
------------------------------------------------
指定使用Werner的二次收敛的MCSCF优化方法。此为默认MCSCF优化算法。
此方法需要[pq|(i+u)(j+v)]的分子轨道积分，当体系的原子轨道数较大时，
请使用关键词``Quasi``或``Superci``所提供的近似方法。

:guilabel:`Mixopt` 参数类型：Bool型
------------------------------------------------
指定混合Werner算法与Quasi算法，如果Werner算法难以收敛，可以使用这个参数。

**MCSCF迭代与收敛阈值控制**

:guilabel:`Macit` 参数类型：整型
------------------------------------------------
指定最大MCSCF宏迭代次数。

:guilabel:`Micit` 参数类型：整型
------------------------------------------------
指定最大MCSCF微迭代次数。

:guilabel:`Ciiter` 参数类型：整型
------------------------------------------------
指定CI计算最大迭代次数。

:guilabel:`Conv` 参数类型：浮点型
------------------------------------------------
默认值：1.D-8 1.d-4

.. note::
 第一个阈值是能量收敛值，第二个阈值是轨道梯度收敛阈值。

:guilabel:`Cmin` 参数类型: 浮点数
------------------------------------------------
指定UGA-CI/iCI截断阈值。
参数描述: 控制酉群组态相互作用（UGA-CI）与智能组态筛选（iCI）方法中组态函数（CSFs）的截断阈值
* 默认值: 1.0d-4
* 功能规则: 当CSFs的权重系数绝对值低于此阈值时，将被自动剔除。阈值越低，计算精度越高但耗时显著增加。
* 输入冲突处理: 若用户在输入文件中显式设置此参数，系统将优先采用用户定义值覆盖默认值。

:guilabel:`Actmin` 参数类型: 浮点数
------------------------------------------------
指定控制iCI方法中活性分子轨道雅可比旋转（Jacobi Rotation）的精度阈值。
* 默认值: 1.0d-6

:guilabel:`Actopt` 参数类型：Bool型
------------------------------------------------
指定活性空间轨道优化方法选择。

* 参数选项说明: 
* ACTOPT=0：禁止在活性空间内进行任何轨道优化。默认状态: 强制生效（无需显式声明）。
* ACTOPT=1: 启用活性空间轨道优化，采用Werner方法或准牛顿法（quasi-Newton）。
* ACTOPT=2: 启用活性空间轨道优化，采用雅可比旋转（Jacobi rotation）。
  优势: 在高精度需求下具有更好的数值稳定性。警告: 活性空间较大时可能导致计算时间显著增加。

:guilabel:`Prtcri` 参数类型：浮点型
------------------------------------------------
指定打印输出的CSF的阈值。
* 默认值：0.05

:guilabel:`SOCcri` 参数类型: 浮点数
------------------------------------------------
指定打印关键词``SOCene``计算所得SOC的阈值。

:guilabel:`Prtiter` 参数类型：Bool型
------------------------------------------------
输出每步宏迭代所得分子轨道至$BDFTASK.mciter.molden文件。

:guilabel:`Maxstep` 参数类型：浮点型
------------------------------------------------
默认值：0.1

.. note::
 轨道转动矩阵元的最大值。即轨道转动的最大步长。

:guilabel:`Ucutoff` 参数类型：浮点型
------------------------------------------------
默认值：1.D-8

指定内空间轨道优化近似积分变换的阈值。该参数对MCSCF计算效率有影响。

**MCSCF中的GUGA-CI计算控制参数**

:guilabel:`Ncisave` 参数类型：整型
------------------------------------------------
默认值：20000

指定最大的可以保存CI矩阵的维数。

:guilabel:`Node` 参数类型：整型
------------------------------------------------
默认值：30000

指定最大的DRT节点数。

:guilabel:`Wei` 参数类型：整型
------------------------------------------------
指定最大的弧权数目。

:guilabel:`Ploop` 参数类型：整型
------------------------------------------------
指定GUGA的Loop搜索最大的部分Loop的数目。

:guilabel:`Nref` 参数类型：整型
------------------------------------------------
默认值：10000

指定参考态的数目。

:guilabel:`Nvff` 参数类型：整型
------------------------------------------------
默认值：10000000

指定活性空间最大双电子积分数目。

**算例**

:guilabel:`test004.inp`
------------------------------------------------

:guilabel:`test015.inp`
------------------------------------------------

:guilabel:`test016.inp`
------------------------------------------------

:guilabel:`test019.inp`
------------------------------------------------

:guilabel:`test020.inp`
------------------------------------------------

:guilabel:`test021.inp`
------------------------------------------------

:guilabel:`test061.inp`
------------------------------------------------

:guilabel:`test069.inp`
------------------------------------------------

:guilabel:`test070.inp`
------------------------------------------------

:guilabel:`test071.inp`
------------------------------------------------

:guilabel:`test080.inp`
------------------------------------------------

:guilabel:`test086.inp`
------------------------------------------------

:guilabel:`test095.inp`
------------------------------------------------

:guilabel:`test100.inp`
------------------------------------------------

:guilabel:`test105.inp`
------------------------------------------------

:guilabel:`test114.inp`
------------------------------------------------

:guilabel:`test126.inp`
------------------------------------------------

:guilabel:`test131.inp`
------------------------------------------------

:guilabel:`test139.inp`
------------------------------------------------

:guilabel:`test148.inp`
------------------------------------------------

:guilabel:`test150.inp`
------------------------------------------------


