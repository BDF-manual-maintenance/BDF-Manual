.. _Irppy3-example:

:math:`\rm Ir(ppy)_3` 磷光发射机制的理论探究
==============================================

自从磷光材料被应用到OLED以来，基于磷光机制的有机发光器件研究快速发展，其中代表性的有红、绿、蓝单基色磷光器件和全磷光白色磷光器件。由于自旋禁阻的原因，磷光量子产率要比荧光低得多，因此通常采用重原子效应等方法来提高磷光量子产率。当引入重原子后，自旋轨道耦合作用加强，使禁阻的三重态向单重态的跃迁变为允许，分子停滞在三线态的时间大幅缩短，极大地提高了器件的内量子效率，常用的重金属原子有Ir、Pt、Re、Os、Cu等。
磷光材料一般应具备良好的光热稳定性、较大的分子吸光截面、较高的系间窜越能力、室温下有较高的磷光量子产率和较短的三线态寿命等特征。由于有机材料中磷光的绿光材料最容易获得，因而研究最早也是从磷光绿光OLED开始，其中 :math:`\rm Ir(ppy)_3` 是最具代表性的材料，被广泛地应用到磷光器件中。磷光发射速率是发光机理研究中的重要参数，本文将以 :math:`\rm Ir(ppy)_3` 为例，使用BDF和MOMAP软件计算其磷光发射速率。首先需要
通过BDF量化软件进行结构优化、频率计算和旋轨耦合计算，之后基于BDF的结构优化和频率计算结果文件、旋轨耦合计算结果文件使用MOMAP软件进行磷光辐射速率的计算。

基态优化
------------

首先使用量化软件BDF进行 :math:`\rm Ir(ppy)_3` 的基态S0和第一激发三重态T1的结构优化和频率计算。

准备 :math:`\rm Ir(ppy)_3` 分子结构的xyz文件如下：

.. code-block:: python

    61

    Ir   -2.606160230000     -0.262817540000      0.032585640000
    C    -3.837298770000      2.407777490000      0.243683290000
    C    -1.553000180000      2.622608110000      0.521271830000
    C    -3.991643180000      3.786525490000      0.422094600000
    C    -4.929719550000      1.476909230000     -0.003856060000
    C    -1.634158680000      3.988444110000      0.709067180000
    H    -0.591261780000      2.126459120000      0.554253960000
    C    -2.889293280000      4.581787990000      0.656041260000
    H    -4.972006580000      4.231616950000      0.376099570000
    C    -6.263398690000      1.888616610000     -0.076321100000
    H    -0.744068550000      4.570116630000      0.889344200000
    H    -2.999939670000      5.647195600000      0.795286530000
    C    -5.623129880000     -0.778047400000     -0.424041550000
    C    -7.264449980000      0.973962040000     -0.319493370000
    H    -6.527094820000      2.928025340000      0.057085040000
    C    -6.940359500000     -0.364034500000     -0.495248330000
    H    -5.397358100000     -1.824987250000     -0.570011260000
    H    -8.293855190000      1.298147200000     -0.375111620000
    H    -7.723296650000     -1.084118350000     -0.689505650000
    C    -2.780095460000     -2.271307610000     -0.073978550000
    C    -2.962145630000     -2.905938610000      1.179649240000
    C    -2.704720750000     -3.101798200000     -1.194651040000
    C    -3.053849400000     -4.297470620000      1.273150410000
    C    -3.052375550000     -2.037406190000      2.345262930000
    C    -2.797310890000     -4.477732940000     -1.095358170000
    H    -2.574810200000     -2.657655530000     -2.171485550000
    C    -2.970830350000     -5.080470100000      0.142706420000
    H    -3.190782260000     -4.777448690000      2.231582660000
    C    -3.251325250000     -2.483356810000      3.656088400000
    H    -2.735191030000     -5.089028800000     -1.985144810000
    H    -3.042943740000     -6.155896270000      0.221114210000
    C    -2.995026490000      0.148733040000      3.092507280000
    C    -3.319187740000     -1.576319800000      4.692855730000
    H    -3.353725050000     -3.536644150000      3.859562860000
    C    -3.186631940000     -0.222801710000      4.408749290000
    H    -2.888815760000      1.194668600000      2.833837140000
    H    -3.472767910000     -1.912494740000      5.707724440000
    H    -3.232610730000      0.522480480000      5.186904590000
    N    -2.927015180000     -0.717593640000      2.090156960000
    C     0.125501920000     -0.309636820000     -1.075330180000
    C     0.242318970000     -0.710559210000      1.197687130000
    C     1.518232510000     -0.401785790000     -1.166132500000
    C    -0.762473880000     -0.044853840000     -2.198985150000
    C     1.619464440000     -0.811598610000      1.179643800000
    H    -0.298309850000     -0.828666640000      2.128258480000
    C     2.270161400000     -0.653514600000     -0.037593100000
    H     2.007628100000     -0.277927520000     -2.118201950000
    C    -2.150460220000     -0.005742870000     -1.917121780000
    C    -0.287950380000      0.157363030000     -3.497950870000
    H     2.165728000000     -1.009392350000      2.088259610000
    H     3.346017750000     -0.726918300000     -0.099292420000
    C    -3.004998770000      0.237880450000     -2.994864780000
    C    -1.165335710000      0.397865570000     -4.532504760000
    H     0.771521710000      0.127613130000     -3.708268180000
    C    -2.529020200000      0.436535570000     -4.277665910000
    H    -4.071982740000      0.267717660000     -2.824596670000
    H    -0.792761550000      0.552584980000     -5.535050450000
    H    -3.220629300000      0.622039860000     -5.087916480000
    N    -0.487689310000     -0.467248190000      0.117089220000
    N    -2.608631830000      1.850704260000      0.298598520000
    C    -4.578169480000      0.115167240000     -0.176155400000

打开Device studio，点击File-new project，命名为 ``phosphorescence.hpf`` ，将 ``Ir(ppy)3_s0.xyz`` 拖入Project中，双击 ``Ir(ppy)3_s0.hzw`` 。接下来进 :math:`\rm Ir(ppy)_3` 基态S0的结构优化和频率计算。选中Simulator → BDF → BDF，在界面中设置参数。在Basic Settings界面中的Calculation Type选择Opt+Freq，方法选择PBE0泛函，基组在Basis中的All Electron类型中，选择Def2-SVP。Basic Settings界面中的其它参数使用推荐的默认值，不需要做修改。

.. figuire:: /Irppy3-example/fig4.1-1.png

在SCF Settings界面中，DFT Integral Grid选择Coarse，Convergence Threshold选择Tight。SCF Settings界面中的其它参数使用推荐的默认值，不需要做修改。

.. figure:: /Irppy3-example/fig4.1-2.png

在OPT Settings界面中，Convergence Threshold选择Tight。OPT Settings界面中的其它参数使用推荐的默认值，不需要做修改。

.. figure:: /Irppy3-example/fig4.1-3.png

Freq Settings界面中的参数使用推荐的默认值，不需要做修改。之后点击 Generate files 即可生成对应计算的输入文件。选中生成的 ``bdf.inp`` 文件，右击选择open with，打开该文件，如下所示：

.. code-block:: bdf

    $compass
    Title
      C33H24IrN3
    Geometry
    Ir -2.60616023 -0.26281754 0.03258564
    C -3.83729877 2.40777749 0.24368329
    C -1.55300018 2.62260811 0.52127183
    C -3.99164318 3.78652549 0.42209460
    C -4.92971955 1.47690923 -0.00385606
    C -1.63415868 3.98844411 0.70906718
    H -0.59126178 2.12645912 0.55425396
    C -2.88929328 4.58178799 0.65604126
    H -4.97200658 4.23161695 0.37609957
    C -6.26339869 1.88861661 -0.07632110
    H -0.74406855 4.57011663 0.88934420
    H -2.99993967 5.64719560 0.79528653
    C -5.62312988 -0.77804740 -0.42404155
    C -7.26444998 0.97396204 -0.31949337
    H -6.52709482 2.92802534 0.05708504
    C -6.94035950 -0.36403450 -0.49524833
    H -5.39735810 -1.82498725 -0.57001126
    H -8.29385519 1.29814720 -0.37511162
    H -7.72329665 -1.08411835 -0.68950565
    C -2.78009546 -2.27130761 -0.07397855
    C -2.96214563 -2.90593861 1.17964924
    C -2.70472075 -3.10179820 -1.19465104
    C -3.05384940 -4.29747062 1.27315041
    C -3.05237555 -2.03740619 2.34526293
    C -2.79731089 -4.47773294 -1.09535817
    H -2.57481020 -2.65765553 -2.17148555
    C -2.97083035 -5.08047010 0.14270642
    H -3.19078226 -4.77744869 2.23158266
    C -3.25132525 -2.48335681 3.65608840
    H -2.73519103 -5.08902880 -1.98514481
    H -3.04294374 -6.15589627 0.22111421
    C -2.99502649 0.14873304 3.09250728
    C -3.31918774 -1.57631980 4.69285573
    H -3.35372505 -3.53664415 3.85956286
    C -3.18663194 -0.22280171 4.40874929
    H -2.88881576 1.19466860 2.83383714
    H -3.47276791 -1.91249474 5.70772444
    H -3.23261073 0.52248048 5.18690459
    N -2.92701518 -0.71759364 2.09015696
    C 0.12550192 -0.30963682 -1.07533018
    C 0.24231897 -0.71055921 1.19768713
    C 1.51823251 -0.40178579 -1.16613250
    C -0.76247388 -0.04485384 -2.19898515
    C 1.61946444 -0.81159861 1.17964380
    H -0.29830985 -0.82866664 2.12825848
    C 2.27016140 -0.65351460 -0.03759310
    H 2.00762810 -0.27792752 -2.11820195
    C -2.15046022 -0.00574287 -1.91712178
    C -0.28795038 0.15736303 -3.49795087
    H 2.16572800 -1.00939235 2.08825961
    H 3.34601775 -0.72691830 -0.09929242
    C -3.00499877 0.23788045 -2.99486478
    C -1.16533571 0.39786557 -4.53250476
    H 0.77152171 0.12761313 -3.70826818
    C -2.52902020 0.43653557 -4.27766591
    H -4.07198274 0.26771766 -2.82459667
    H -0.79276155 0.55258498 -5.53505045
    H -3.22062930 0.62203986 -5.08791648
    N -0.48768931 -0.46724819 0.11708922
    N -2.60863183 1.85070426 0.29859852
    C -4.57816948 0.11516724 -0.17615540
    End Geometry
    Basis
      Def2-SVP
    Skeleton
    Group
      C(1)
    $end
    
    $bdfopt
    Solver
      1
    MaxCycle
      366
    TolGrad
      3.0E-5
    TolStep
      1.2E-4
    IOpt
      3
    Hess
      final
    $end
    
    $xuanyuan
    Direct
    $end
    
    $scf
    RKS
    Charge
      0
    SpinMulti
      1
    DFT
      PBE0
    D3
    Grid
      Coarse
    ThreshConv
      1.0D-9  5.0D-7
    MPEC+COSX
    Molden
    $end
    
    $resp
    Geom
    $end

选中 ``bdf.inp`` 文件，右击选择Run，弹出如下服务器提交的界面：

.. figure:: /Irppy3-example/fig4.1-4.png

点击Run提交作业。任务结束后 ``bdf.out`` ， ``bdf.out.tmp`` ， ``bdf.scf.molden`` 三个结果文件会出现在Project中。

选择 ``bdf.out`` ，右击show view，在Optimization对话框中，显示结构已经达到收敛标准。

.. figure:: /Irppy3-example/fig4.1-5.png 

在Frequency对话框中，检查频率，若不存在虚频证明结构已经优化到极小点。

.. figure:: /Irppy3-example/fig4.1-6.png

激发态优化
-----------

选择 ``bdf.out`` 文件，右击open with containing folder打开所在文件夹，在 ``bdf.out`` 文件中查找 ``converged in`` ，紧接着输出的 ``Molecular Cartesian Coordinates (X,Y,Z) in Angstrom :`` 下的结构即为优化好的 :math:`\rm Ir(ppy)_3` 的S0结构。

将其保存为 ``Irppy3_t1.xyz`` 文件，将 ``Irppy3_t1.xyz`` 拖入Device Studio中进行T1激发态的结构优化和频率计算。

``Irppy3_t1.xyz`` 内容如下：

.. code-block:: python

    61

     Ir         -0.00021963       0.00084588       0.01424181
      C           2.59517396      -1.31710199      -0.58086411
      C           2.23709967       0.40664133      -2.11684705
      C           3.82729349      -1.60375453      -1.18851600
      C           2.03843393      -2.01080680       0.57861773
      C           3.44334868       0.17103124      -2.75937571
      H           1.56522101       1.20579483      -2.43942631
      C           4.25160770      -0.86138490      -2.27959559
      H           4.44860577      -2.40719663      -0.79331056
      C           2.69382363      -3.08153995       1.20802708
      H           3.74085930       0.78654308      -3.60925966
      H           5.21146469      -1.08097154      -2.75293386
      C           0.24421139      -2.16970311       2.17811922
      C           2.12763720      -3.69300459       2.31682204
      H           3.65478554      -3.44259873       0.83261331
      C           0.89831764      -3.22978876       2.79882363
      H          -0.71249803      -1.82386403       2.57651491
      H           2.63779958      -4.52517522       2.80699129
      H           0.44660698      -3.70582388       3.67403286
      C          -1.72035469       0.07933387       1.04722001
      C          -2.76313413      -0.76101290       0.56881686
      C          -2.01025266       0.87257612       2.17113445
      C          -4.02037491      -0.79383502       1.19368759
      C          -2.43582629      -1.59048558      -0.58889316
      C          -3.25751526       0.83538180       2.78746398
      H          -1.23410642       1.52839366       2.57249446
      C          -4.27126073       0.00210869       2.30157161
      H          -4.81180920      -1.44586060       0.81528272
      C          -3.29617560      -2.51740929      -1.19724703
      H          -3.44731484       1.46422538       3.66217358
      H          -5.24881003      -0.02406750       2.78811438
      C          -0.75837785      -2.14128396      -2.11906742
      C          -2.86048279      -3.25738595      -2.28544733
      H          -4.30328496      -2.65589425      -0.80436165
      C          -1.56140370      -3.07140479      -2.76199645
      H           0.27022263      -1.95736074      -2.43892538
      H          -3.52729093      -3.98185076      -2.75888376
      H          -1.17316801      -3.63790053      -3.60937499
      N          -1.18202102      -1.42059810      -1.07683756
      C          -0.15520348       2.90563657      -0.58971088
      C          -1.46338895       1.72871866      -2.12679953
      C          -0.52211987       4.11414752      -1.20165791
      C           0.72001848       2.77388462       0.57312738
      C          -1.86121725       2.88919512      -2.77366419
      H          -1.81791319       0.74611096      -2.44764729
      C          -1.37377275       4.10694585      -2.29536844
      H          -0.13934280       5.05543436      -0.80755998
      C           0.92315032       1.45037015       1.05224777
      C           1.31701199       3.87857243       1.20194236
      H          -2.54044030       2.83638038      -3.62545723
      H          -1.66304625       5.04659184      -2.77183207
      C           1.74847348       1.30397901       2.18095829
      C           2.12513377       3.69714085       2.31457434
      H           1.15050564       4.89023888       0.82308669
      C           2.33662182       2.40226678       2.80117156
      H           1.92559465       0.30363467       2.58285826
      H           2.58863363       4.55643063       2.80428368
      H           2.97087444       2.25159426       3.67958431
      N          -0.63391888       1.73510439      -1.07938881
      N           1.82331270      -0.31615001      -1.07209969
      C           0.78888390      -1.52564414       1.05342887

选择Simulator → BDF → BDF，在界面中设置参数。在Basic Settings界面中的Calculation Type选择TDDFT-OPT+Freq，方法采用默认的PBE0泛函，基组在Basis中的All Electron类型中，选择Def2-SVP。Basic Settings界面中的其它参数使用推荐的默认值，不需要做修改。

.. figure:: /Irppy3-example/fig4.2-1.png

SCF Settings界面中将Use MPEC+COSX Acceleraton的默认勾选去掉。SCF Settings界面中的其它参数使用推荐的默认值，不需要做修改。

.. figure:: /Irppy3-example/fig4.2-2.png

TDDFT Settings面板中将Use MPEC+COSX Acceleraton的默认勾选去掉。Mutiplicity选择Triplet，Convergence Threshold选择Very Tight。TDDFT Settings界面中的其它参数使用推荐的默认值，不需要做修改。

.. figure:: /Irppy3-example/fig4.2-3.png

OPT Settings和Freq Settings面板的参数使用推荐的默认值，不需要做修改。之后点击 Generate files 即可生成对应计算的输入文件。选中生成的 ``bdf.inp`` 文件，右击选择open containing folder进入所在文件夹，在 ``bdf.inp`` 的 ``$tddft`` 模块中加入：

.. code-block:: python

    Gridtol
    1E-6

``bdf.inp`` 内容如下：

.. code-block:: bdf

    $compass
    Title
      C33H24IrN3
    Geometry
    Ir -0.00021963 0.00084588 0.01424181
    C 2.59517396 -1.31710199 -0.58086411
    C 2.23709967 0.40664133 -2.11684705
    C 3.82729349 -1.60375453 -1.18851600
    C 2.03843393 -2.01080680 0.57861773
    C 3.44334868 0.17103124 -2.75937571
    H 1.56522101 1.20579483 -2.43942631
    C 4.25160770 -0.86138490 -2.27959559
    H 4.44860577 -2.40719663 -0.79331056
    C 2.69382363 -3.08153995 1.20802708
    H 3.74085930 0.78654308 -3.60925966
    H 5.21146469 -1.08097154 -2.75293386
    C 0.24421139 -2.16970311 2.17811922
    C 2.12763720 -3.69300459 2.31682204
    H 3.65478554 -3.44259873 0.83261331
    C 0.89831764 -3.22978876 2.79882363
    H -0.71249803 -1.82386403 2.57651491
    H 2.63779958 -4.52517522 2.80699129
    H 0.44660698 -3.70582388 3.67403286
    C -1.72035469 0.07933387 1.04722001
    C -2.76313413 -0.76101290 0.56881686
    C -2.01025266 0.87257612 2.17113445
    C -4.02037491 -0.79383502 1.19368759
    C -2.43582629 -1.59048558 -0.58889316
    C -3.25751526 0.83538180 2.78746398
    H -1.23410642 1.52839366 2.57249446
    C -4.27126073 0.00210869 2.30157161
    H -4.81180920 -1.44586060 0.81528272
    C -3.29617560 -2.51740929 -1.19724703
    H -3.44731484 1.46422538 3.66217358
    H -5.24881003 -0.02406750 2.78811438
    C -0.75837785 -2.14128396 -2.11906742
    C -2.86048279 -3.25738595 -2.28544733
    H -4.30328496 -2.65589425 -0.80436165
    C -1.56140370 -3.07140479 -2.76199645
    H 0.27022263 -1.95736074 -2.43892538
    H -3.52729093 -3.98185076 -2.75888376
    H -1.17316801 -3.63790053 -3.60937499
    N -1.18202102 -1.42059810 -1.07683756
    C -0.15520348 2.90563657 -0.58971088
    C -1.46338895 1.72871866 -2.12679953
    C -0.52211987 4.11414752 -1.20165791
    C 0.72001848 2.77388462 0.57312738
    C -1.86121725 2.88919512 -2.77366419
    H -1.81791319 0.74611096 -2.44764729
    C -1.37377275 4.10694585 -2.29536844
    H -0.13934280 5.05543436 -0.80755998
    C 0.92315032 1.45037015 1.05224777
    C 1.31701199 3.87857243 1.20194236
    H -2.54044030 2.83638038 -3.62545723
    H -1.66304625 5.04659184 -2.77183207
    C 1.74847348 1.30397901 2.18095829
    C 2.12513377 3.69714085 2.31457434
    H 1.15050564 4.89023888 0.82308669
    C 2.33662182 2.40226678 2.80117156
    H 1.92559465 0.30363467 2.58285826
    H 2.58863363 4.55643063 2.80428368
    H 2.97087444 2.25159426 3.67958431
    N -0.63391888 1.73510439 -1.07938881
    N 1.82331270 -0.31615001 -1.07209969
    C 0.78888390 -1.52564414 1.05342887
    End Geometry
    Basis
      Def2-SVP
    Skeleton
    Group
      C(1)
    $end
    
    $bdfopt
    Solver
      1
    MaxCycle
      366
    IOpt
      3
    Hess
      final
    $end
    
    $xuanyuan
    Direct
    $end
    
    $scf
    RKS
    Charge
      0
    SpinMulti
      1
    DFT
      PBE0
    D3
    Molden
    $end
    
    $tddft
    Imethod
      1
    Isf
      1
    Ialda
      4
    Idiag
      1
    crit_e
      1E-9
    crit_vec
      1E-7
    Gridtol
      1E-6
    Iroot
      6
    Istore
      1
    $end
    
    $resp
    Geom
    Method
      2
    Nfiles
      1
    Iroot
      1
    $end

选中 ``bdf.inp`` 文件，右击选择Run提交作业，任务结束后 ``bdf.out`` ， ``bdf.out.tmp`` ， ``bdf.scf.molden`` 三个结果文件会出现在Project中。

选择 ``bdf.out``，右击show view，在Optimization对话框中，显示结构已经达到收敛标准。

.. figure:: /Irppy3-example/fig4.2-4.png

在Frequency对话框中，检查频率，若不存在虚频证明结构已经优化到极小点。

.. figure:: /Irppy3-example/fig4.2-5.png

自旋轨道耦合
-------------

选择 ``bdf.out`` 文件，右击open with containing folder打开 ``bdf.out`` 文件，在文件中查找 ``converged in`` ，紧接着输出的 ``Molecular Cartesian Coordinates (X,Y,Z) in Angstrom :`` 下的结构即为优化好的T1激发态的结构。将其保存为 ``Irppy3_t1_soc.xyz`` 文件，如下：

.. code-block:: python

    61

      Ir          0.00713728       0.02772384       0.06844143 
      C           2.49525480      -1.44901550      -0.61634342 
      C           2.18832036       0.30085414      -2.14613716 
      C           3.68634391      -1.80881598      -1.26572189 
      C           1.93194560      -2.11689508       0.55823360 
      C           3.35838993      -0.00562745      -2.82371008 
      H           1.54555778       1.13535499      -2.43828057 
      C           4.11644204      -1.08671357      -2.36826138 
      H           4.27131595      -2.65056635      -0.89578008 
      C           2.53568350      -3.23676194       1.15281696 
      H           3.66807720       0.59265321      -3.68133338 
      H           5.04582829      -1.36185464      -2.87261245 
      C           0.15985754      -2.20796739       2.19060975 
      C           1.95468524      -3.83725789       2.26057143 
      H           3.46642195      -3.64596143       0.75209976 
      C           0.76249168      -3.31842903       2.77624738 
      H          -0.76777546      -1.81381956       2.61329026 
      H           2.42616559      -4.70662836       2.72403491 
      H           0.30108846      -3.78788395       3.64972556 
      C          -1.72817262       0.21988877       1.05055833 
      C          -2.80684294      -0.57231379       0.57552059 
      C          -1.98377974       1.07446425       2.13652018 
      C          -4.07348284      -0.50293868       1.17614116 
      C          -2.51722058      -1.44616477      -0.55935718 
      C          -3.24105830       1.13344573       2.72846833 
      H          -1.17254968       1.69178400       2.52835606 
      C          -4.29332764       0.34509124       2.25152759 
      H          -4.89835192      -1.11318656       0.80076906 
      C          -3.42583031      -2.33456216      -1.15446766 
      H          -3.40666531       1.80444609       3.57586126 
      H          -5.27935386       0.39610056       2.71819787 
      C          -0.85701735      -2.13799807      -2.04878703 
      C          -3.02057249      -3.12865177      -2.21547404 
      H          -4.44525951      -2.39959512      -0.77498376 
      C          -1.70631730      -3.03592702      -2.67708276 
      H           0.18295061      -2.02278722      -2.36320871 
      H          -3.72428268      -3.82273458      -2.68079360 
      H          -1.34337957      -3.64618311      -3.50492143 
      N          -1.25281509      -1.36491844      -1.03498749 
      C           0.05749757       2.91146589      -0.57266019 
      C          -1.32777267       1.80183369      -2.13392316 
      C          -0.20378718       4.13789922      -1.23242993 
      C           0.84833732       2.74053836       0.60027468 
      C          -1.62207961       2.97568834      -2.79963589 
      H          -1.76529075       0.85235254      -2.45705604 
      C          -1.02279372       4.18710974      -2.33345871 
      H           0.25619858       5.05119986      -0.85064151 
      C           0.99228869       1.37116718       1.10523883 
      C           1.50408647       3.78492492       1.29091761 
      H          -2.29824567       2.96275979      -3.65460398 
      H          -1.21968527       5.13470890      -2.83803374 
      C           1.79964051       1.14876808       2.23660071 
      C           2.27478596       3.51131149       2.40946143 
      H           1.40861651       4.81693356       0.94742301 
      C           2.43450283       2.19478112       2.89597173 
      H           1.90681895       0.12796182       2.60984200 
      H           2.77105979       4.33756352       2.92655136 
      H           3.04508360       2.00761950       3.78145403 
      N          -0.50508694       1.73366277      -1.08285478 
      N           1.77567220      -0.40171722      -1.08777429 
      C           0.72548984      -1.57229627       1.07484739 

基于T1激发态结构，做S0和T1之间的旋轨耦合SOC计算。将Irppy3_t1_soc.xyz拖入Device Studio中，选择Simulator → BDF → BDF，界面中设置参数。在Basic Settings界面中的Calculation Type选择TDDFT-SOC，Functional选择PBE0泛函，取消勾选Use Dispersion Correction。Hamiltonian选择sf-X2C，Basis选择All Electron类型下的x2c-SVPall基组。

.. figure:: /Irppy3-example/fig4.3-1.png

在TDDFT Settings面板中的Spin-Orbit Coupling内容框中，勾选Including Ground State。

.. figure:: /Irppy3-example/fig4.3-2.png

Basic Settings、SCF Settings和TDDFT Settings界面中的其它参数使用推荐的默认值，不需要做修改。之后点击 Generate files 即可生成对应计算的输入文件。选中生成的 ``bdf.inp`` 文件，右击选择open with，打开该文件，如下所示：

生成的输入文件 ``bdf.inp`` 为：

.. code-block:: bdf

    $compass
    Title
      C33H24IrN3
    Geometry
    Ir 0.00713728 0.02772384 0.06844143
    C 2.49525480 -1.44901550 -0.61634342
    C 2.18832036 0.30085414 -2.14613715
    C 3.68634391 -1.80881598 -1.26572189
    C 1.93194560 -2.11689507 0.55823360
    C 3.35838993 -0.00562745 -2.82371008
    H 1.54555778 1.13535498 -2.43828056
    C 4.11644203 -1.08671356 -2.36826137
    H 4.27131594 -2.65056635 -0.89578008
    C 2.53568350 -3.23676194 1.15281696
    H 3.66807719 0.59265321 -3.68133337
    H 5.04582829 -1.36185464 -2.87261245
    C 0.15985754 -2.20796738 2.19060975
    C 1.95468524 -3.83725789 2.26057143
    H 3.46642195 -3.64596142 0.75209976
    C 0.76249168 -3.31842902 2.77624738
    H -0.76777546 -1.81381956 2.61329025
    H 2.42616559 -4.70662835 2.72403490
    H 0.30108846 -3.78788394 3.64972555
    C -1.72817262 0.21988877 1.05055833
    C -2.80684294 -0.57231379 0.57552059
    C -1.98377973 1.07446424 2.13652018
    C -4.07348283 -0.50293868 1.17614116
    C -2.51722058 -1.44616477 -0.55935718
    C -3.24105830 1.13344573 2.72846833
    H -1.17254967 1.69178400 2.52835606
    C -4.29332764 0.34509124 2.25152758
    H -4.89835191 -1.11318655 0.80076906
    C -3.42583030 -2.33456215 -1.15446765
    H -3.40666531 1.80444608 3.57586125
    H -5.27935385 0.39610056 2.71819787
    C -0.85701735 -2.13799807 -2.04878703
    C -3.02057249 -3.12865176 -2.21547404
    H -4.44525950 -2.39959511 -0.77498376
    C -1.70631730 -3.03592701 -2.67708275
    H 0.18295061 -2.02278722 -2.36320870
    H -3.72428268 -3.82273458 -2.68079359
    H -1.34337957 -3.64618310 -3.50492143
    N -1.25281508 -1.36491844 -1.03498749
    C 0.05749757 2.91146589 -0.57266019
    C -1.32777267 1.80183369 -2.13392316
    C -0.20378718 4.13789922 -1.23242992
    C 0.84833732 2.74053836 0.60027467
    C -1.62207960 2.97568834 -2.79963588
    H -1.76529074 0.85235254 -2.45705603
    C -1.02279371 4.18710974 -2.33345870
    H 0.25619858 5.05119985 -0.85064151
    C 0.99228869 1.37116718 1.10523883
    C 1.50408647 3.78492491 1.29091760
    H -2.29824567 2.96275978 -3.65460398
    H -1.21968527 5.13470889 -2.83803374
    C 1.79964050 1.14876807 2.23660070
    C 2.27478596 3.51131149 2.40946142
    H 1.40861651 4.81693355 0.94742301
    C 2.43450283 2.19478112 2.89597172
    H 1.90681894 0.12796182 2.60984200
    H 2.77105978 4.33756351 2.92655136
    H 3.04508359 2.00761950 3.78145402
    N -0.50508694 1.73366277 -1.08285477
    N 1.77567220 -0.40171722 -1.08777429
    C 0.72548984 -1.57229627 1.07484738
    End Geometry
    Basis
      x2c-SVPall
    Skeleton
    Group
      C(1)
    $end
    
    $xuanyuan
    Heff
      21
    Hsoc
      2
    Direct
    $end
    
    $scf
    RKS
    Charge
      0
    SpinMulti
      1
    DFT
      PBE0
    MPEC+COSX
    Molden
    $end
    
    $tddft
    Imethod
      1
    Isf
      0
    Idiag
      1
    Iroot
      6
    MPEC+COSX
    Istore
      1
    $end
    
    $tddft
    Imethod
      1
    Isf
      1
    Idiag
      1
    Iroot
      6
    MPEC+COSX
    Istore
      2
    $end
    
    $tddft
    Isoc
      2
    Nfiles
      2
    Ifgs
      1
    Imatsoc
      -1
    Imatrsf
      -1
    Imatrso
      -2
    $end

选中 ``bdf.inp`` 文件，右击选择Run提交作业，任务结束后 ``bdf.out`` ， ``bdf.scf.molden`` 结果文件会出现在Project中。选择 ``bdf.out`` ，右击选择show view，在TDDFT面板中，选择Spinor，在Dominant Excitations中确定第2、3和4为T1态的三个分量。

.. figure:: /Irppy3-example/fig4.3-3.png

点击 ``bdf.out`` 文件，右击选择Open Containing Folder进入所在文件夹，打开 ``bdf.out`` ，查找 ``[tddft_soc_matrso]:`` ，输出了考虑SOC之后各激发态相对于基态的能量和跃迁偶极矩。

.. code-block:: python

     [tddft_soc_matrso]: Print selected matrix elements of [dpl] 
 
  No.  ( I , J )   |rij|^2       E_J-E_I         fosc          rate(s^-1)
 -------------------------------------------------------------------------------
   1     1    2   0.104E-02    2.196064924    0.000056149     0.117E+05
   Details of transition dipole moment with SOC (in a.u.):
                   <I|X|J>       <I|Y|J>       <I|Z|J>        (also in debye) 
          Real=   0.279E-01     0.161E-01    -0.216E-02     0.0710   0.0409  -0.0055
          Imag=   0.123E-07    -0.291E-07    -0.867E-08     0.0000  -0.0000  -0.0000
          Norm=   0.279E-01     0.161E-01     0.216E-02
 
  No.  ( I , J )   |rij|^2       E_J-E_I         fosc          rate(s^-1)
 -------------------------------------------------------------------------------
   2     1    3   0.354E-03    2.201474871    0.000019090     0.401E+04
   Details of transition dipole moment with SOC (in a.u.):
                   <I|X|J>       <I|Y|J>       <I|Z|J>        (also in debye) 
          Real=   0.587E-02     0.179E-01     0.126E-03     0.0149   0.0454   0.0003
          Imag=  -0.108E-06    -0.357E-07     0.361E-07    -0.0000  -0.0000   0.0000
          Norm=   0.587E-02     0.179E-01     0.126E-03
 
  No.  ( I , J )   |rij|^2       E_J-E_I         fosc          rate(s^-1)
 -------------------------------------------------------------------------------
   3     1    4   0.259E-01    2.210597826    0.001400915     0.297E+06
   Details of transition dipole moment with SOC (in a.u.):
                   <I|X|J>       <I|Y|J>       <I|Z|J>        (also in debye) 
          Real=   0.905E-08    -0.356E-07    -0.418E-08     0.0000  -0.0000  -0.0000
          Imag=  -0.535E-01     0.148E+00     0.316E-01    -0.1360   0.3771   0.0802
          Norm=   0.535E-01     0.148E+00     0.316E-01
 
  No.  ( I , J )   |rij|^2       E_J-E_I         fosc          rate(s^-1)
 -------------------------------------------------------------------------------
   4     1    5   0.154E+00    2.538843563    0.009594212     0.268E+07
   Details of transition dipole moment with SOC (in a.u.):
                   <I|X|J>       <I|Y|J>       <I|Z|J>        (also in debye) 
          Real=  -0.236E+00     0.158E+00     0.271E+00    -0.5998   0.4010   0.6899
          Imag=  -0.271E-06     0.183E-06     0.310E-06    -0.0000   0.0000   0.0000
          Norm=   0.236E+00     0.158E+00     0.271E+00
 
  No.  ( I , J )   |rij|^2       E_J-E_I         fosc          rate(s^-1)
 -------------------------------------------------------------------------------
   5     1    6   0.275E-02    2.591483156    0.000174312     0.508E+05
   Details of transition dipole moment with SOC (in a.u.):
                   <I|X|J>       <I|Y|J>       <I|Z|J>        (also in debye) 
          Real=   0.339E-01     0.292E-01     0.273E-01     0.0861   0.0743   0.0693
          Imag=  -0.132E-07     0.447E-07     0.428E-07    -0.0000   0.0000   0.0000
          Norm=   0.339E-01     0.292E-01     0.273E-01

其中， ``1  1`` 表示基态固有偶极矩； ``1  2`` 表示第一个与第二个旋量态间的跃迁偶极矩，以此类推。这里需要第2、3和4激发态的激发能和跃迁偶极矩数据。

激发能在E_J-E_I列下读取，分别为2.201474871 eV，2.210597826 eV和2.538843563 eV。转换为以au单位分别为0.080902668 a.u., 0.081237931 a.u.和0.093300733 a.u.。

跃迁偶极矩的数据在 ``Details of transition dipole moment with SOC (in a.u.):`` 中列出，前三列为单位为au的偶极矩数据，后三列为单位为Debye的偶极矩数据。

将debye单位下六个数的平方之和开方，得到该态的跃迁偶极矩。另一种方法为将Norm后的三个数平方之和开方，再乘以2.5417。得到第2、3和4激发态的跃迁偶极矩为0.04778347 Debye, 0.408818358 Debye和0.998260011 Debye。

得到的这6个参数将用于MOMAP软件的磷光发射速率的计算中。

至此，MOMAP对 :math:`\rm Ir(ppy)_3` 的磷光辐射速率计算需要的BDF量化软件的结构优化频率结果文件、旋轨耦合计算结果文件和参数部分都已完成。

磷光辐射速率
-------------

接下来开始使用MOMAP进行 :math:`\rm Ir(ppy)_3` 的磷光辐射速率的计算。

首先计算T1→S0的磷光辐射速率，第一步为做电子振动耦合（electron-vibration coupling, EVC）计算，该计算基于量化计算输出的分子振动频率、力常数矩阵，同时在内坐标以及直角坐标系下，计算分子跃迁发生初末态间的模式位移、黄昆因子、重整能以及Duschinsky转动矩阵。

将BDF软件计算得到的 :math:`\rm Ir(ppy)_3` 的基态的优化频率计算文件改名为 ``irppy3_s0.out`` ，和T1优化频率计算文件改名为 ``irppy3_t1.out`` ，同时放在EVC计算文件夹中。

EVC计算的输入文件 ``momap.inp`` 为：

.. code-block:: python

    do_evc=1

    &evc
	    ffreq(1)="irppy3_s0.out"
	    ffreq(2)="irppy3_t1.out"
	    proj_reorg=.t.
    /

提交脚本文件 ``momap.slurm`` 运行任务。任务正常结束后，使用 ``evc.cart.dat`` 进行接下来的T1→S0磷光发射速率计算。对T1的三个态依次进行计算，其中第一个子态，即第2个态的磷光发射速率，输入文件 ``momap.inp`` 为:

.. code-block:: python

    do_spec_tvcf_ft   = 1
    do_spec_tvcf_spec = 1
    
    &spec_tvcf
      DUSHIN        = .t. 
      Temp          = 300 K
      tmax          = 1000 fs
      dt            = 1   fs  
      Ead           = 0.080902668 au
      EDMA          = 1 debye
      EDME          = 0.04778347 debye
      FreqScale     = 1
      DSFile        = "evc.cart.dat"
      Emax          = 0.3 au
      dE            = 0.00001 au
      logFile       = "spec.tvcf.log"
      FtFile        = "spec.tvcf.ft.dat"
      FoFile        = "spec.tvcf.fo.dat"
      FoSFile       = "spec.tvcf.spec.dat"
    /

提交脚本文件 ``momap.slurm`` 运行任务。任务结束后，确认关联函数是否收敛。

打开 ``spec.tvcf.log`` ，文件末尾输出了第2个态的磷光辐射速率值，

.. code-block:: python

    radiative rate     (0):     1.82745093E-13    7.55493312E+03 /s,     1.32364E+05 ns

磷光辐射速率在第一个数和第二个数读取，单位分别为a.u.和s-1，第三个数为寿命，单位为ns。这里为 7.55493312E+03 /s。

第二个子态，即第3个态的磷光发射速率，输入文件 ``momap.inp`` 为:

.. code-block:: python

    do_spec_tvcf_ft   = 1
    do_spec_tvcf_spec = 1
    
    &spec_tvcf
      DUSHIN        = .t. 
      Temp          = 300 K
      tmax          = 1000 fs
      dt            = 1   fs  
      Ead           = 0.081237931 au
      EDMA          = 1 debye
      EDME          = 0.408818358 debye
      FreqScale     = 1
      DSFile        = "evc.cart.dat"
      Emax          = 0.3 au
      dE            = 0.00001 au
      logFile       = "spec.tvcf.log"
      FtFile        = "spec.tvcf.ft.dat"
      FoFile        = "spec.tvcf.fo.dat"
      FoSFile       = "spec.tvcf.spec.dat"
    /

提交脚本文件 ``momap.slurm`` 运行任务。任务结束后，确认关联函数是否收敛。

打开 ``spec.tvcf.log`` ，文件末尾输出了第3个态的磷光辐射速率值，

.. code-block:: python

    radiative rate     (0):     1.34914628E-11    5.57755602E+05 /s,    1792.90 ns

磷光辐射速率为 5.57755602E+05 /s。

第三个子态，即第4个态的磷光发射速率，输入文件 ``momap.inp`` 为:

.. code-block:: python

    do_spec_tvcf_ft   = 1
    do_spec_tvcf_spec = 1
    
    &spec_tvcf
      DUSHIN        = .t. 
      Temp          = 300 K
      tmax          = 1000 fs
      dt            = 1   fs  
      Ead           = 0.093300733 au
      EDMA          = 1 debye
      EDME          = 0.998260011 debye
      FreqScale     = 1
      DSFile        = "evc.cart.dat"
      Emax          = 0.3 au
      dE            = 0.00001 au
      logFile       = "spec.tvcf.log"
      FtFile        = "spec.tvcf.ft.dat"
      FoFile        = "spec.tvcf.fo.dat"
      FoSFile       = "spec.tvcf.spec.dat"
    /

提交脚本文件 ``momap.slurm`` 运行任务。任务结束后，确认关联函数是否收敛。

打开 ``spec.tvcf.log`` ，文件末尾输出了第4个态的磷光辐射速率值，

.. code-block:: python

    radiative rate     (0):     1.08105308E-10    4.46922190E+06 /s,     223.75 ns

磷光辐射速率为 4.46922190E+06 /s。

根据三个子态E_J-E_I能量的玻尔兹曼分布，得到第2个态占58.73%，第3个态占41.27%，第4个态占0%。

因此对三个子态的磷光发射速率乘以相应的比例，加和得到T1态的磷光发射速率为2.346119845E+05 /s。
