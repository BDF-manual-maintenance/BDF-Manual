tddft模块
================================================
TDDFT模块基于线形响应理论，通过求解Casida方程计算分子激发态。TDDFT支持完全的TDHF、TDDFT，TDA、SA-TDDFT和X-TDDFT等方法。可以处理基态是闭壳层或者是开壳层的分子体系。其中SA-TDDFT与X-TDDFT是BDF的特色，对基态是开壳层大的分子体系，可以部分解决自旋污染问题。

**常用关键词**

:guilabel:`Imethod` 参数类型：整型
------------------------------------------------
可选值：1、2

指定基于哪种基态计算方法进行TDDFT计算。1为R-TDFDT, 基态为RHF/RKS方法；2为U-TDDFT，基态为UHF/UKS/ROHF/ROKS方法。其中自旋匹配X-TDDFT需要从ROKS/ROHF出发，采用U-TDDFT，利用imethod=1,itest=1,icorrect=1计算。

:guilabel:`Isf` 参数类型：整型
---------------------------------------------------
可选值：0、1、2

控制是否进行spin-flip的TDDDFT计算。0为no spin-flip；1为spin flip up；-1为spin flip down。

:guilabel:`Itda` 参数类型：整型
------------------------------------------------
默认值：0

可选值：0、1

控制是否进行TDA计算。0为完全TDDDFT计算，使用TDA；完全TDDFT计算，不使用TDA。

:guilabel:`Ialda` 参数类型：整型
---------------------------------------------------
可选值：0、1、2、3、4

指定TDDFT交换相关核。0为full non-collinear kernel；1为non-collinear ALDA kernel；2为no-collinear ALDA0 kernel, 推荐spin-flip TDDFT计算时使用；3为full non-collinear，产生自自旋平均密度；4为full collinear kernel (spin-flip TDDFT梯度与NAC)。

:guilabel:`Itest & icorrect` 参数类型：整型
------------------------------------------------
默认值：0

可选值：Itest为1、icorrect为2

Itest与icorrect参数与imetehod=2联用，基于ROKS/ROHF轨道做X-TDDFT计算。

:guilabel:`iact & elw & eup` 参数类型：整型，浮点型，浮点型
---------------------------------------------------
Iact=1，通过定义激发能量下限与上限，指定TDDFT求解某个能量窗口的激发态。Elw为浮点数，能量下限，单位eV；Eup为浮点数，能量上限，单位eV。

:guilabel:`Idiag` 参数类型：整型
------------------------------------------------
可选值：1、2、3

指定TDDFT的对角化方法。1为基于Davidson方法的迭代对角化；2为完全对角化；3为iVI 对角化，支持TDA与AO-TDDFT。

:guilabel:`Aokxc` 参数类型：Bool型
---------------------------------------------------
指定基于AO计算交换相关Kernel的对TDDFT的Casida矩阵贡献。

:guilabel:`Iguess` 参数类型：整型
------------------------------------------------
可选值：10*x+y

控制TDDFT初始猜测波函数。X=0: 对角元猜测；X=1: 从文件读入初始波函数；X=2: 紧束缚近似猜测；Y=0: 不存储Davidson迭代中间过程向量；Y=1: 存储Davidson迭代中间过程向量。

**收敛控制关键词**

:guilabel:`Crit_e` 参数类型：浮点型
------------------------------------------------
指定TDDFT计算能量收敛阈值。

:guilabel:`Cirt_vec` 参数类型：浮点型
---------------------------------------------------
指定TDDFT计算波函数收敛阈值。

**激发态数目控制关键词**

:guilabel:`Iroot` 参数类型：整型
------------------------------------------------
指定TDDFT计算每个不可约表示根的数目。

:guilabel:`Nroot` 参数类型：整型数组
---------------------------------------------------
对每个不可约表示可以指定不同数目的根。

**波函数存储关键词**

:guilabel:`Istore` 参数类型：整型
------------------------------------------------
指定将波函数存储与编号为n的文件中，已备其他计算使用。

:guilabel:`Lefteig` 参数类型：Bool型
---------------------------------------------------
指定TDDFT计算，X-Y向量也保存到文件中。

**激发组态打印输出控制**

:guilabel:`Nprt` 参数类型：整型
------------------------------------------------


:guilabel:`Cdthrd` 参数类型：浮点型
---------------------------------------------------
指定打印绝对值大于cdtrd的组态激发信息。

**TD-DFT/SOC和性质计算控制参数**

:guilabel:`Nfiles` 参数类型：整型数组
------------------------------------------------
nfiles是包含n+1个整数的多行参数，第一行输入为n，表示要读入n个先前的TDDFT波函数，其余n行分别指定要读入的文件号。

:guilabel:`Isoc` 参数类型：整型
---------------------------------------------------
可选值：1、2、3

指定TDDFT-SOC计算方法。1为仅闭壳层体系计算；2为一般的SOC计算；3为仅打印两个自旋独立态之间的SOC耦合矩阵元，不对角化Hsoc。

:guilabel:`Ifgs` 参数类型：整型
------------------------------------------------
默认值：0

可选值：0、1

指定TDDFT-SOC计算是否包含基态。0为TDDFT-SOC计算不包含基态；1为TDDDFT-SOC计算包含基态。

:guilabel:`Imatsoc` 参数类型：整型数组
---------------------------------------------------
指定需要计算的SOC矩阵元。

.. code-block:: python

     ...
     #SCF calculation for the ground state S0. It is a singlet.
     $scf
     spin
     0
     ...
     $end

     #First TDDFT, singlets S0-S9.
     $tddft
     imethod
     1
     isf
     0
     iext
     10
     ....
     $end

     #Second TDDFT, triplet T1-T10
     $tddft
     imethod
     1
     isf
     1
     iexit
     10
     $end

     $tddft
     ....
     imatsoc         #如果imatsoc<0，所有的SOC矩阵元都要计算
      7              #表示7个SOC矩阵元将被计算，后面的的7行指定要计算哪7个SOC矩阵元  
     0 0 0 2 1 1     #字符串“0 0 0“代表基态
     0 0 0 2 1 2     #3个数字“i m n”代表第“i”次TDDFT计算，第“m”个不可约表示的第“n”个态
     1 1 1 2 1 1     #计算矩阵<S1|HSOC|T1>
     1 1 1 2 1 2
     1 1 2 2 1 1
     1 1 2 2 1 2
     2 1 1 2 1 1
     2 1 1 2 1 2
     $end

:guilabel:`Imatrsf` 参数类型：整型
------------------------------------------------
指定计算自旋独立态之间的跃迁偶极矩，输入类似imatsoc，imatrsf=-1可以打印所有的自旋独立态见的跃迁偶极矩。

:guilabel:`Imatrso` 参数类型：整型数组
---------------------------------------------------
指定打印考虑了SOC之后电子态之间的跃迁偶极矩。

.. code-block:: python

     $TDDFT
     ...
     Imatrso
     5          #指定需要打印5组态之间的跃迁矩，后面5行指定打印哪些态之间的跃迁矩
     1 1
     1 2
     1 3
     2 3
     2 4
     $END

**自然跃迁轨道(Natural Transition Orbital -- NTO)分析**

:guilabel:`Ntoanalyze` 参数类型：整型数组
---------------------------------------------------
指定对TDDFT计算的某些态做NTO分析。

.. code-block:: python

     $TDDFT
     istore
     1           #第一个TDDFT完成激发态计算，并存储TDDFT波函数，已备后续使用
     $End

     $TDDFF
     Ntoanalyze
     2           #指定对两个态做NTO分析
     1 3         #指定对第1和第3个激发态做NTO分析
     $End

**内存控制参数**

:guilabel:`Memjkop` 参数类型：整型
---------------------------------------------------
控制积分直接的TDDFT计算J，K算符时的内存大小，如果分配的内存不存储所有的J、K算符，TDDFT将按照指定内存计算一次能存储的J，K算符数目，通过多次积分计算完成每次迭代对角化的所有J，K算符计算。多次积分计算将降低计算效率。

:guilabel:`Imemshrink` 参数类型：整型
---------------------------------------------------
默认值：0

可选值：0、1

控制积分直接TDDFT计算J、K算符时，OpenMP并行对内存的使用方式。0为不降低内存使用量；1为降低OpenMP并行内存使用量，效率稍低。如果计算的分子体系特别大，要求的计算根数目特别多，memjkop参数无法在增大内存，使用这个参数比积分多次计算效率高。
