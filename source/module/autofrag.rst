分子自动分片，FLMO和iOI计算 - AUTOFRAG模块
================================================

与BDF的其他模块不同，autofrag是基于python开发的，用于使基于FLMO的计算更简洁。autofrag的主要功能是对大分子进行自动分片，并自动产生FLMO计算的输入。autofrag还是iOI-SCF的计算引擎，用于调度SCF的其他模块完成iOI计算。autofrag模块主要计算流程为：

 * 根据分子坐标自动产生原子的键连信息；
 * 切断某些键，产生合适的分子片段；
 * 对分子片段增加缓冲原子；
 * 在断键处添加连接H原子或者投影杂化轨道PHO (Projected Hybrid Orbital);
 * 生成子体系分子片段的输入文件，利用并行化的模式计算分子片段；
 * 组织子体系分子片段计算结果，运行整体分子计算。

``autofrag`` 必须放在 ``compass`` 之前。autofrag会处理 ``compass`` 模块中的分子结构，进行分子键判断，分片等。autofrag后的输入还被作为产生分子片段及整体计算输入的模版。利用autofrag做完整的例子见 :ref:`iOI-SCF计算示例<iOI-Example>`

:guilabel:`Method` 参数类型：字符串
------------------------------------------------
默认值：FLMO

可选值：FLMO、iOI

设定计算方法。 FLMO-计算分片定域化分子轨道；iOI - iOI-SCF计算，用分子片合成分子的方法计算大分子体系。iOI目前仅支持限制性自洽场计算。

:guilabel:`nproc` 参数类型：整数
------------------------------------------------
默认值：1

可选值：小于等于分子片数的正整数

设定iOI计算最大可用进程数。由于分子片计算是独立的，可并行计算。注意，如果任务在单计算节点运行，nproc*nompthreads不应该超过最大可用CPU核心的数目。nompthreads是每个进程的可用OpenMP线程数。


:guilabel:`radbuff`  参数类型： 浮点
-----------------------------------------------
默认值：2.0

可选值： 非负浮点数

设定分子片缓冲区半径，增加radbuff不改变分子片数目，但会增加每个分子片的尺寸。对于iOI计算，radbuff定义的是第0次宏迭代时分子片缓冲区的大小，缓冲区将在宏迭代过程中增大。

:guilabel:`iOIThresh`  参数类型： 浮点
-----------------------------------------------
默认值：0.1

可选值： 非负浮点数

设定iOI-SCF分子片段计算的收敛阈值。减小iOIThresh会增加iOI计算的宏迭代次数，但改进了整体分子计算的初始轨道，所以会加快整体分子的SCF收敛。

:guilabel:`PHO`  参数类型： Bool
-----------------------------------------------
默认值： 对于iOI为True，FLMO为False

设置利用 **PHO** (Project Hybrid orbital) 而不是连接氢 (**H**) 原子来饱和分子分片时的断键处。该方法比加氢原子要精确，但计算量稍大。当radbuff为0.0或者很小时，推荐使用PHO。

:guilabel:`charge`  参数类型： 整数数组
-----------------------------------------------
默认值：无

设定给定原子的电荷数，用以协助指定分子片段的电荷。当某分子片段电子数难以确定或不为偶数时，通过指定电荷来确定分子片段总的电子数。格式如下：

.. code-block:: bdf
  
  charge
  10 +2 25 -1 78 -1

这里，指定第10个原子的电荷数为+2，第25个原子的电荷数为-1，第78个原子的电荷数为-1。原子所属的分子片段电荷数将被设定为相应的值以确定总的电子数。

:guilabel:`spinmulti`  参数类型： 整数数组
-----------------------------------------------
默认值：无

**备注： 子宽检查，似乎和算例不一样。spin到底是非成对电子数还是自旋多重度。可能需要改为合适的关键词。**

设定给定原子的自旋多重度，用以协助计算到合适的自旋态。输入格式和 ``charge`` 关键词相同。

.. code-block:: bdf
  
  spinmult
  13 +1 17 -1

这里，指定第13个原子有个未成对的alpha电子，第17个原子有个未成对的beta电子。注意，所有的开壳层原子都应该被指定。如果有多个未配对电子，需要先画出所有的配对电子所在的共振结构，在根据共振结构指定自旋到相应的原子上。( **用户可能不理解** )

:guilabel:`maxiter`  参数类型： 整数
-----------------------------------------------
默认值：无

指定iOI-SCF最大的宏迭代次数。

:guilabel:`Dryrun`  参数类型： Bool
-----------------------------------------------
默认值：False

设定只产生FLMO或iOI-SCF输入文件，而不执行计算。




