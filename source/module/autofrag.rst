分子自动分片，FLMO和iOI计算 - AUTOFRAG模块
================================================

autofrag的主要功能是对大分子进行自动分片，并自动产生FLMO计算的输入。autofrag还是iOI-SCF的计算引擎，用于调度SCF的其他模块完成iOI计算。autofrag模块主要计算流程为：

 * 根据分子坐标自动产生原子的键连信息；
 * 切断某些键，产生合适的分子片段；
 * 对分子片段增加缓冲原子；
 * 在断键处添加连接H原子或者投影杂化轨道PHO (Projected Hybrid Orbital);
 * 生成子体系分子片段的输入文件，利用并行化的模式计算分子片段；
 * 组织子体系分子片段计算结果，运行整体分子计算。

``autofrag`` 必须放在 ``compass`` 之前。autofrag会处理 ``compass`` 模块中的分子结构，进行分子键判断，分片等。autofrag后的输入还被作为产生分子片段及整体计算输入的模版。利用autofrag做完整的例子见 :ref:`iOI-SCF计算示例<iOI-Example>`

:guilabel:`Method` 参数类型：字符串
------------------------------------------------
 * 默认值：FLMO
 * 可选值：FLMO、iOI

设定计算方法。 FLMO - 计算分片定域化分子轨道；iOI - iOI-SCF计算，用分子片合成分子的方法计算大分子体系。iOI目前仅支持限制性自洽场计算。

:guilabel:`nprocs` 参数类型：整数
------------------------------------------------
 * 默认值：1
 * 可选值：小于等于分子片数的正整数

设定iOI计算最大可用进程数。由于分子片计算是独立的，可并行计算，此处nprocs指的即是最多允许多少个分子片同时计算。注意当nprocs不等于1时，环境变量OMP_NUM_THREADS指定的是iOI计算的总OpenMP线程数，而不是每个进程的可用OpenMP线程数。例如当环境变量OMP_NUM_THREADS=16，且nprocs为2时，代表iOI计算中同时最多有2个子体系在并行计算，每个子体系使用8个OpenMP线程。

:guilabel:`radcent`  参数类型： 浮点
-----------------------------------------------
 * 默认值：3.0
 * 可选值：非负浮点数

设定初始分子片（即尚未添加缓冲区的分子片）的大小（单位：埃），增加radcent会增加每个分子片的尺寸，且减少分子片的数目。

:guilabel:`radbuff`  参数类型： 浮点
-----------------------------------------------
 * 默认值：2.0
 * 可选值：非负浮点数

设定分子片缓冲区半径（单位：埃）。与radcent不同，增加radbuff不改变分子片数目，但会增加每个分子片的尺寸。对于iOI计算，radbuff定义的是第0次宏迭代时分子片缓冲区的大小，缓冲区将在宏迭代过程中增大。

:guilabel:`iOIThresh`  参数类型： 浮点
-----------------------------------------------
 * 默认值：0.1
 * 可选值：正浮点数

设定iOI-SCF分子片段计算的收敛阈值。减小iOIThresh会增加iOI计算的宏迭代次数，但改进了整体分子计算的初始轨道，所以会加快整体分子的SCF收敛。

:guilabel:`NoPHO`  参数类型： Bool
-----------------------------------------------

设置不利用 **PHO** (Project Hybrid orbital) ，而是利用连接氢 (**H**) 原子来饱和分子分片时的断键处。使用该关键词时，子体系计算的计算量比默认的 **PHO** 方法稍小，但子体系轨道的精度低，可能导致整体分子的SCF迭代次数增加，乃至使总计算时间增加。

:guilabel:`charge`  参数类型： 整数数组
-----------------------------------------------
 * 默认值：无

设定给定原子的电荷数，用以协助指定分子片段的电荷。当程序难以自动确定某分子片段电子数时，用户可以通过指定电荷来确定分子片段总的电子数。格式如下：

.. code-block:: bdf
  
  charge
  10 +2 25 -1 78 -1

这里，指定第10个原子的电荷数为+2，第25个原子的电荷数为-1，第78个原子的电荷数为-1。原子所属的分子片段电荷数将会依照用户给出的原子电荷数来进行确定。

:guilabel:`spinocc`  参数类型： 整数数组
-----------------------------------------------
 * 默认值：无

设定给定原子的形式自旋，用以协助计算到合适的自旋态。输入格式和 ``charge`` 关键词相同。

.. code-block:: bdf
  
  spinocc
  13 +1 17 -1

这里，指定第13个原子有1个未成对的alpha电子，第17个原子有1个未成对的beta电子。注意，所有的开壳层原子都应该被指定。例如一个体系有两个Cu(II)中心，则两个Cu的形式自旋可以都不指定（此时总体系收敛到哪个自旋态是不确定的），也可以都指定，但是不能只指定其中一个的形式自旋而不指定另外一个的形式自旋；但是如果两个Cu原子之中有一个是Cu(I)，则Cu(I)的形式自旋可以不指定，因为其为闭壳层原子。如果体系有离域的自旋，则应该画出让该自旋局域在某个原子上的共振式，再按该共振式指定形式自旋。例如乙烯自由基阳离子的两个碳原子均带有形式正电荷+0.5和形式自旋+0.5，但是指定形式自旋时应该将其中任意一个碳的形式自旋指定为+1，另一个碳的形式自旋指定为0（因为此时该碳原子是闭壳层原子，相应的形式自旋也可以不用指定），而不能把两个碳原子的形式自旋都指定为+0.5。

:guilabel:`maxiter`  参数类型： 整数
-----------------------------------------------
 * 默认值：50

指定iOI-SCF最大的宏迭代次数。

:guilabel:`Dryrun`  参数类型： Bool
-----------------------------------------------
 * 默认值：False

设定只产生FLMO或iOI-SCF输入文件，而不执行计算。




