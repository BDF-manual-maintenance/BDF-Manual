DFT/TDDFT梯度、Hessian及响应性质 - RESP模块
================================================
resp模块用于计算DFT/TDDFT的梯度，TDDFT的基态-激发态，激发态-激发态之间的非绝热耦合。

**基本关键词**

:guilabel:`Iprt` 参数类型：整型
------------------------------------------------
控制打印输出级别，主要用于程序调试。

:guilabel:`NOrder` 参数类型：整型
------------------------------------------------
可选值：1、2

几何坐标导数的阶数，目前仅支持1（解析梯度），2（解析Hessian）尚不支持。本参数要求必须先指定Geom。

:guilabel:`Geom` 参数类型：Bool型
------------------------------------------------
本关键字无需提供参数，需要与Norder关键词联用，用于指定计算几何坐标一阶或二阶导数。

指定resp计算一阶或二阶梯度。1.梯度或Fo-NACMEs；2.Hessian(正在开发中)

:guilabel:`NFiles` 参数类型：整型
------------------------------------------------
对于TD-DFT响应性质计算，指定读取哪个$tddft块的计算结果；注意当该参数等于x时，并不简单代表读取第x个$tddft块的计算结果，而是指读取istore值为x的那个$tddft块的计算结果。例如对于某闭壳层分子，以下输入（$compass、$xuanyuan、$scf略去）：

.. code-block:: bdf

     $tddft
     imethod
     1
     Nexit
     1
     istore
     1
     lefteig
     $end

     $tddft
     imethod
     1
     isf
     1
     Nexit
     1
     istore
     2
     lefteig
     $end

     $resp
     geom
     norder
     1
     method
     2
     nfiles
     2            #计算第一三重态激发态的梯度，而不是第一单重态激发态的梯度，因为nfiles=2，而只有第2个$tddft块（计算第一三重态激发态）的istore=2
     $end

:guilabel:`Imethod, Method` 参数类型：整型
------------------------------------------------
默认值：1

可选值：1、2

指定进行DFT基态计算还是TD-DFT激发态计算。1为基态，如指定2，则为激发态计算。使用Imethod，Method将被删除。

.. code-block:: bdf

     #计算第一个TD-DFT激发态的TD-DFT梯度
     $tddft
     imethod
     1
     Nexit
     1
     istore
     1
     lefteig
     $end

     $resp
     geom
     norder
     1
     imethod
     2
     nfiles
     1
     $end

.. code-block:: bdf

     #计算基态梯度
     $resp
     geom
     norder
     1
     imethod
     1
     $end

:guilabel:`Nrootgrad` 参数类型：整型
------------------------------------------------
指定计算MCSCF的那个根的梯度。

:guilabel:`Cthrd` 参数类型：
------------------------------------------------


:guilabel:`Ignore` 参数类型：整型
------------------------------------------------
默认值：0

可选值：-1、0、1

用于TDDFT梯度计算的数据一致性检查，主要用于调试程序。
-1：重新计算TDDFT的激发能，用于检查Resp和TDDFT模块对能量计算是否一致。
0: 执行Wmo矩阵偏离度检查。
1: 忽略Wmo矩阵偏离度检查。理论上，Wmo应该为零，如果TDDFDT或者Z-Vector迭代没有完全收敛，或者程序有Bug，Wmo会偏离0。如果Wmo大于3x10-5，TDDFT梯度计算将中断并检查原因。设置ignore=1，忽略该项检查，TDDFT梯度计算可以继续执行，但结果可能不精确。

:guilabel:`IRep&IRoot` 参数类型：整型
------------------------------------------------
这两个关键字指定计算哪个/哪些态的TD-DFT梯度。分4种情况：
（1）	既指定IRep，又指定IRoot：如以下的输入
.. code-block:: bdf

     #计算第2个不可约表示（irrep）下的第3个根的梯度
     irep
     2
     iroot
     3

（2）	只指定IRep：计算该不可约表示下的所有根的梯度。
（3）	只指定IRoot：例如
.. code-block:: bdf

     #将所有不可约表示下计算的根按照能量从低到高排序，然后计算第3个根的梯度
     iroot
     3
     
（4）	两者都不指定：计算tddft得到的所有态的梯度。

:guilabel:`JahnTeller` 参数类型：字符串
------------------------------------------------
如果分子具有高的对称性，分子所属点群是高阶点群，基于TDDFT的结构优化分子可能出现JahnTeller形变，但形变方向可能有多个。例如，一个具有Ih对称性的分子，有一个三重简并的激发态T2g，可以降低到对称性达到D2h，D3d，D5d或其他子群。因此，TDDFT结构优化中，分子可能结构优化的第二步可能降低对称性。JahnTeller关键词用于指定一个分子点群，从而引导分子向指定的点群方向形变。

.. code-block:: bdf

     $Tddft
     ...
     JahnTeller
      D(2h)
     $End
   
:guilabel:`Line` 参数类型：Bool型
------------------------------------------------
执行resp进行线性响应计算。

:guilabel:`Reduced` 参数类型：Bool型
------------------------------------------------
指定resp求解约化的线性响应方程 :math:`[(A-B)(A+B)w2](X+Y) = RVo+RVvo`

:guilabel:`Pola` 参数类型：字符串
--------------------------------------------------------
可选值：Aoper、Boper、Bfreq

Plorizability: <<A; B>>(wB),其中A，B算符可以是dipole(DIP), Quadruple(QUA), SOC(HSO), EFG。

:guilabel:`Quad` 参数类型：Bool型
------------------------------------------------
指定resp进行二次响应计算
Hype:Aoper,Boper,BFreq,Coper,CFreq
Hyperpolarizability:<<A,B,C>>(wB,wC)。

:guilabel:`Fnac` 参数类型：Bool型
------------------------------------------------
指定resp计算一阶非绝热耦合（first-oder noadibatic couplings）向量，需要与Single或者Double参数联用，分别指定计算基态-激发态、激发态-激发态非绝热耦合向量。

:guilabel:`Single` 参数类型：Bool型
------------------------------------------------
指定计算基态-激发态非绝热耦合向量。

:guilabel:`States` 参数类型：整型数组
------------------------------------------------
指定计算哪些态与基态的非绝热耦合向量。本参数是多行参数：
第一行：输入整数n, 指定要计算基态与n个激发态之间的非绝热耦合向量。
第二行至第n+1行，指定电子态，格式为 m i l 三个整数，m为先前的TDDFT计算istore指定存储的文件编号，i为第i个不可约表示，l是该不可约表示的第l个根。

:guilabel:`Double` 参数类型：Bool型
------------------------------------------------
指定计算激发态-激发态非绝热耦合向量。

:guilabel:`Pairs` 参数类型：整型数组
------------------------------------------------
指定计算那两组激发态之间的非绝热耦合向量。本参数是多行参数：
第一行：输入整数n, 指定要计算n对激发态之间的非绝热耦合向量。
第二行至第n+1行，指定电子态，格式为 m1 i1 l1 m2 i2 l2 三个整数，每三个整数指定一个激发态。m1为先前的TDDFT计算istore指定存储的文件编号，i1为第i1个不可约表示，l1是该不可约表示的第l1个根。另三个整数同理。

:guilabel:`Noresp` 参数类型：Bool型
------------------------------------------------
指定在Double和FNAC计算中忽略跃迁密度矩阵的响应项（推荐使用）。

:guilabel:`Fdif` 参数类型：Bool型
------------------------------------------------
指定使用有限差分计算梯度。

:guilabel:`Step` 参数类型：浮点型
------------------------------------------------
默认值：0.001 Unit

指定有限差分计算的步长。

:guilabel:`Bohr` 参数类型：Bool型
------------------------------------------------
指定差分步长单位为Bohr，默认angstrom。

