多参考自洽场计算 - MCSCF模块
===============================================

多组态自洽场计算模块，如果没有定义活性空间，则进行二阶收敛的RHF计算。如果不优化分子轨道，仅进行CASCI计算。

**常用关键词**

:guilabel:`AutoMC` 参数类型： Bool型
------------------------------------------------
 * 默认值：False

根据 ``$expandmo`` 模块的结果自动设置关键词 close、active、actel。若用户未使用 ``$expandmo`` 自动选择活性空间，则无法使用此关键词。
若用户在输入文件中手动设置了 ``close`` 、 ``active`` 、 ``actel`` ， ``AutoMC`` 的设置将被覆盖。

:guilabel:`Core` 参数类型：整型
------------------------------------------------
每个不可约表示（irreps）中冻结的内部轨道数量。

:guilabel:`Delete` 参数类型：整型
------------------------------------------------
每个不可约表示（irreps）中冻结的外部轨道数量。

:guilabel:`Close` 参数类型：整型
------------------------------------------------
每个不可约表示（irreps）中未冻结但不在活性空间内的内部轨道数量。

:guilabel:`Active` 参数类型：整型
------------------------------------------------
每个不可约表示（irreps）中活性轨道数量。若无活性空间，将进行近似二阶RHF计算。

:guilabel:`XvrSet` 参数类型： Bool型
------------------------------------------------
 * 默认值：False

根据 ``$expandmo`` 模块关键词 ``VSD`` 虚空间分解结果设置 MCSCF XVR。 将 MCSCF 分子轨道顺序设置为closed、active、Vir、Xvr。
参见test126.inp。

:guilabel:`Virdel` 参数类型： Bool型
------------------------------------------------
 * 默认值：False

将 MCSCF 分子轨道顺序设置为 closed、active、Xvr 、Vir 。
参见test126.inp。

:guilabel:`XvrUse` 参数类型： Bool型
------------------------------------------------
 * 默认值：False

将 MCSCF XVR 输出到 chkfil，供 ``$traint`` 模块中关键词 ``XvrUse`` 使用。

:guilabel:`Actel` 参数类型：整型
------------------------------------------------
活性空间中活性电子的数量。若无活性空间，将进行近似二阶RHF计算。

:guilabel:`RootPrt` 参数类型：整型
------------------------------------------------
 * 默认值：1

计算该电子态的数值梯度，并在 ``$numgrad`` 模块打印该目标态的能量。
如RootPrt为3，表示打印第3个态的能量。

:guilabel:`Symmetry` 参数类型：整型
------------------------------------------------
目标态的对称性。

:guilabel:`Symm` 参数类型：整型
------------------------------------------------
目标态的对称性，同 ``Symmetry`` 。

:guilabel:`Spin` 参数类型：整型
------------------------------------------------
自旋多重度（2S+1）。例如，Spin为1表示单重态，Spin为2表示双重态。

:guilabel:`Roots` 参数类型：整型数组
------------------------------------------------
需要提供三行或一行的参数信息。
 - 第一行：两个整数。第一个表示态平均考虑的电子态数量，第二个是在CI中计算的电子态数量。
 - 第二行：列举态平均考虑的电子态序号。
 - 第三行：态平均计算中每个电子态的权重。

.. code-block:: bdf

     $MCSCF
     ...
     Roots
      3 4          #态平均考虑3个电子态，CI计算4个电子态。
      1 2 3        #态平均考虑第1、2、3个电子态。
      1 1 1        #3个电子态的权重相同均为1。
     $end

上述内容也可用一行表示。

.. code-block:: bdf

     $MCSCF
     ...
     Roots
      3 4 1        #态平均考虑能量最低的3个电子态，CI计算4个电子态，态平均的电子态权重均为1。
     $end

:guilabel:`Actfrz` 参数类型：整型数组
------------------------------------------------
用于冻结实际上是芯层轨道的活性分子轨道，通常用于计算芯层电子激发。
 - 第一行：冻结的活性轨道的数量。
 - 第二行：冻结的活性轨道的序号。

.. code-block:: bdf

     $MCSCF
     ...
     actfrz
      3
      10 11 12     #第10、11、12个轨道为芯层轨道。
     $end

:guilabel:`CVS` 参数类型： Bool型
------------------------------------------------
 * 默认值：False

芯层分离（Core Valence Separation），用于GUGA的芯层电子激发计算。

:guilabel:`RAS` 参数类型：整型数组
------------------------------------------------
控制RASSCF计算时需要提供若干行参数。
 - 第一行：RAS空间的数量（如RAS1, RAS2, RAS3等），第N个空间为CAS空间（CAS空间中允许所有电子激发）。
 - 第二行：双占RAS空间允许激发电子数或未占RAS空间允许接受电子数，CAS空间的总电子数。
 - 第三行起：各RAS空间每个不可约表示（irreps）中活性轨道数量。
 - 使用 ``RAS`` 关键词后， ``active`` 关键词将不再起作用，可省略。

.. code-block:: bdf

     $MCSCF
     ...
     RAS
      2 2	    #共2个RAS空间，第2个空间为CAS空间。
      2 6	    #第1个RAS空间（RAS1）最多允许2个电子激发，第二个RAS空间（RAS2,为CAS空间）允许全部6个电子激发。
      5 0 0 3	    #RAS1每个不可约表示的活性轨道数。
      0 2 3 1	    #RAS2每个不可约表示的活性轨道数。
     $end

:guilabel:`GAS` 参数类型：整型数组
------------------------------------------------
控制GASSCF计算时需要提供若干行参数。
 - 第一行：GAS空间的数量，如GAS1, GAS2, GAS3等。
 - 第二行：每个GAS空间的最小电子占据数。
 - 第三行：每个GAS空间的最大电子占据数。
 - 第四行起：各GAS空间中每个不可约表示的活性轨道数。
 - 使用 ``GAS`` 关键词后， ``active`` 关键词将不再起作用，可省略。

.. code-block:: bdf

     $MCSCF
     ...
     GAS
      2 	   #共2个GAS空间。
      2 4          #第1个GAS空间（GAS1）最小电子占据数为2，GAS2最小电子占据数为4。
      4 10         #第1个GAS空间（GAS1）最大电子占据数为4，GAS2最大电子占据数为10。
      2 0 0 0      #RAS1每个不可约表示的活性轨道数。
      2 0 2 2      #RAS2每个不可约表示的活性轨道数。
     $end

:guilabel:`MixCI` 参数类型：整型数组
------------------------------------------------
控制不同自旋和空间对称性的态平均CASSCF计算需要提供四行参数。
 - 第一行：不同自旋/空间对称性CI计算的数量。
 - 第二行：每个对称性的自旋多重度。
 - 第三行：每个对称性态平均计算的电子态数量。
 - 第四行：每个对称性的不可约表示。
 - 注释：使用 ``MixCI`` 关键词后， ``spin`` 和 ``symmetry`` 关键词将不再起作用，可省略。

.. code-block:: bdf

     $MCSCF
     ...
     MixCI
      3            #共3种不同对称性的CI计算。
      1 3 5        #单重态、三重态、五重态。
      3 1 2        #每个对称性分别计算3、1、2个电子态。
      1 4 3        #3种CI计算的空间对称性分别对应第1、4、3个不可约表示。
     $end

:guilabel:`Guess` 参数类型：字符串
------------------------------------------------
指定初猜的类型。
 * 默认值：hforb
 * 可选值：read、hforb、mcorb、atom、hcore、huckel、lmo、lmomc、pflmo、cflmo、flmo、mcinp

    - ``hforb``：从临时目录$BDF_TMPDIR读取$BDFTASK.hforbs。
    - ``read``：从工作目录$BDF_WORKDIR依次尝试读取 $BDFTASK.inporb, $BDFTASK.casorb, $BDFTASK.scforb。
    - ``mcorb``：从临时目录$BDF_TMPDIR读取$BDFTASK.mcorb，设置最近的MCSCF 分子轨道作为初始猜测。
    - ``atom``：设置正交归一化的原子轨道（OAOs）为初猜。
    - ``hcore``：设置Nuclear核哈密顿量为初猜。
    - ``huckel``：设置Extend Huckel 哈密顿量为初猜。
    - ``lmo``：从工作目录$BDF_WORKDIR读取$BDFTASK.localorb。
    - ``lmomc``：从工作目录$BDF_WORKDIR读取$BDFTASK.lmomcorb。
    - ``pflmo``：从工作目录$BDF_WORKDIR读取$BDFTASK.pflmoorb。
    - ``cflmo``：从工作目录$BDF_WORKDIR读取$BDFTASK.mcinporb。
    - ``flmo``：从工作目录$BDF_WORKDIR读取$BDFTASK.flmoorb。
    - ``mcinp``：从工作目录$BDF_WORKDIR读取$BDFTASK.mcinporb，按能量升序排序。

..
 【inporb仿佛或许已经删了吗】
 
:guilabel:`Direct` 参数类型： Bool型
------------------------------------------------
 * 默认值：False

在MCSCF计算的每个微迭代（micor-iteration）中进行一步直接CI计算（direct CI），适用于大体系CI计算。

:guilabel:`Molden` 参数类型： Bool型
------------------------------------------------
 * 默认值：False

将MCSCF轨道输出到.molden文件。

:guilabel:`iprtmo` 参数类型：整型
------------------------------------------------
 * 可选值：1、2

是否打印分子轨道系数。1为仅打印轨道能量和占据数；2为打印轨道能量、占据数和系数。

:guilabel:`UGA` 参数类型：Bool型
------------------------------------------------
 * 默认值：True

使用UGA作为CASCI求解器。

:guilabel:`iCI` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

使用iCI作为CASCI求解器。

:guilabel:`iCIPT2` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

将活性轨道作为关联轨道进行iCIPT2计算。

..
 :guilabel:`CFGICI` 参数类型：Bool型
 ------------------------------------------------
  * 默认值：False
 使用轨道 CFG (oCFG) 作为 iCI 或 iCIPT2 的初始态，而不是默认的 CSF 作为初始态进行iCI或iCIPT2计算。 
 参见test139.inp该关键词与 ``$xianci`` 的 ``readref`` 结合使用。 

:guilabel:`GUGA` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

使用GUGA作为CASCI求解器。

:guilabel:`SOCCAS` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

使用TUGA计算SO-CASSCF。

:guilabel:`SOCene` 参数类型：Bool型
------------------------------------------------
 * 默认值：True

计算所有电子态的SOC，目前只支持GUGA（默认，不需要设置 ``GUGA`` ），需要 ``$xuanyuan`` 模块进行SOC积分，例如：

.. code-block:: bdf

     $xuanyuan
     scalar
     heff
     3
     soint
     hsoc
     2
     $end
              
:guilabel:`SOCcri` 参数类型：浮点型
------------------------------------------------
 * 默认值：0.d0

设置SOCene的打印阈值。

:guilabel:`Actopt` 参数类型：整型
------------------------------------------------
 * 默认值：0
 * 可选值：0、1、2

    - 0：不在活性空间内部旋转活性轨道（active−active）进行优化，CASSCF计算中无需考虑，是默认设置。
    - 1：使用Werner方法或quasi-Newton方法在活性空间内部进行轨道优化（active−active轨道旋转）。
    - 2：使用Jacobi rotation方法在活性空间内部进行轨道优化（active−active轨道旋转）。
    - iCISCF计算需设置actopt为1或2.

:guilabel:`CIread` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

除了第一次CI计算外，每一步CI计算都以前一个CI向量作为初始猜测。

:guilabel:`iCIread` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

使用前一个iCI向量作为初始向量。默认不读取。

:guilabel:`NCIsave` 参数类型：整型
------------------------------------------------
 * 默认值：20000

CI哈密顿矩阵可保存在内存上的最大维数。如果CI维数大于NCIsave，则使用Davidson对角化方法。

..
 :guilabel:`SaveLoop` 参数类型：Bool型
 ------------------------------------------------
  * 默认值：False
 如果设置SaveLoop=true，则只计算一次LOOPs，并保存在磁盘上。使用Davidson对角化方法时，SaveLoop将自动设为true。

:guilabel:`Quasi` 参数类型：Bool型
------------------------------------------------
使用近似二阶方法Quasi-Newton方法进行轨道优化。
Quasi-Newton比Newton-Raphson等方法，需要的内存更少且分子轨道积分变换速度更快。

:guilabel:`Werner` 参数类型：Bool型
------------------------------------------------
 * 默认值：True

使用二阶的Werner非线性优化方法进行轨道优化，这是默认方法。
注意：请使用关键词Quasi检查结果，如果结果不同，请使用MOLPRO和MOLCAS等其他程序进行检查。

..
 :guilabel:`Mixopt` 参数类型：Bool型
 ------------------------------------------------
  * 默认值：False
 使用近似的二阶Werner非线性优化方法进行轨道优化。
 需与Werner联用，使用quasi进行分子轨道优化时，此设置无效。

..
 :guilabel:`Localmc` 参数类型：字符串
 ------------------------------------------------
  * 默认值：Ltopdown
  * 可选值：Ltopdown、Lmcnmo
    - Ltopdown：自上而下最小变化（top-down last-change）
    - Lmcnmo：对MRCIS的一阶约化密度矩阵进行块对角化
 使用局域 MCSCF方法进行轨道优化，只支持无对称性体系（ ``$compass`` 模块中使用关键字 ``nosym`` ）。

:guilabel:`Locpflmo` 参数类型：Bool型  
------------------------------------------------
 * 默认值：False

如果存在文件 $BDFTASK.pflmo，则使用该文件作为Ltopdown的初始LMOs。

:guilabel:`Locflmo` 参数类型：Bool型
------------------------------------------------
如果存在文件 $BDFTASK.flmo，则使用该文件作为Ltopdown的初始LMOs。

:guilabel:`NoLmocls` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

使用Ltopdown时，不对MCSCF的双占空间进行局域化。

:guilabel:`NoLmoact` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

使用Ltopdown时，不对MCSCF的活性空间进行局域化。

:guilabel:`NoLmovir` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

使用Ltopdown时，不对MCSCF的虚空间进行局域化。

:guilabel:`Seleci` 参数类型：整型数组   
------------------------------------------------
指定CSF占据数进行sCI（selected CI）计算。
  - 第一行：设置选定CSF占据数（Nref）、进行sCI计算的活性轨道数和激发数。
  - 第二行至第Nref+1行：分别设置选定CSF的占据数，其中2、1、0分别对应双占轨道、单占轨道和空轨道。

.. code-block:: bdf

    $MCSCF
    ...
    SELEREF
    3 4 2
    2200 
    2110
    2020
    $end

也可以通过$BDF_WORKDIR文件夹中的$BDFTASK.select1、$BDFTASK.select2等文件设置不同自旋和空间对称性的CSF占据数。

.. code-block:: bdf

    $MCSCF
    ...
    SELEREF
    0 0 2  	#从文件select1或select2中读取CSF占据数，最多考虑2个电子的激发。
    $end

:guilabel:`SortAct` 参数类型：整型数组
------------------------------------------------
  - 第一行：设置需要转轨道的对数。
  - 第二行：设置需要转进活性空间的分子轨道的序号。
  - 第三行：设置需要转出活性空间的分子轨道的序号。

.. code-block:: bdf

    $MCSCF
    ...
    Sortact
    3
    10 15 20  	   #轨道10、15、20转进活性空间
    12 13 14       #轨道12、13、14转出活性空间
    $end

:guilabel:`Enesort` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

按轨道能量对初始分子轨道重新排序。

:guilabel:`NoProperty` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

不进行性质计算，保留CASSCF优化后的分子轨道，不生成自然轨道或准正则（quasi-canonical）轨道。

:guilabel:`Nature` 参数类型：Bool型
------------------------------------------------
 * 默认值：True

打印自然轨道。
注意：在 ``Localmc`` 计算中不能使用此选项。

:guilabel:`Qcmo` 参数类型：Bool型
------------------------------------------------
打印平均正则轨道。

:guilabel:`StateMO` 参数类型：整型
------------------------------------------------
 * 默认值：0

设置打印指定电子态的分子轨道，StateMO为0时表示打印态平均的分子轨道。

:guilabel:`MO2AO` 参数类型：Bool型
------------------------------------------------
将SCF分子轨道以非正交AO的形式输出到Molden格式文件，使用此关键字时仅输出Molden文件，不进行MCSCF计算。

..
 :guilabel:`AOintSort` 参数类型：Bool型
 ------------------------------------------------
  * 默认值：False
 对原子轨道积分AOINTs进行重排序，使得Nint=Nij*Nkl。使用此关键词时将改变原本保存的AOINTs。	【吗】

:guilabel:`IntCre` 参数类型：整型			
------------------------------------------------
更改保存AOINTs的内存大小。
maxint=int(maxint*intcre)，默认maxint为268435456。

:guilabel:`NoGrad` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

轨道Hessian不存储到硬盘，轨道Hessian用于解析梯度计算。

:guilabel:`iCAS` 参数类型：字符串
------------------------------------------------
 * 默认值：MOM
 * 可选值：MOM、Hungary、SVD

基于MOM/SVD/Hungary使用iCAS方法在MCSCF迭代过程中检查非活性空间、活性空间和虚空间。

:guilabel:`Actadd` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

当使用此关键字结合iCAS或SVD检查活性空间时，将视情况自动增大活性轨道数。

**参数关键词**

:guilabel:`Conv` 参数类型：浮点数组
------------------------------------------------
 * 默认值：1.d-8，1.d-4

CI优化和轨道梯度的收敛阈值。

.. code-block:: bdf

    $MCSCF
    ...
    Conv
    1.d-8 1.d-4
    $end

:guilabel:`Macit` 参数类型：整型
------------------------------------------------
 * 默认值：50

宏迭代的最大步数。

:guilabel:`Micit` 参数类型：整型
------------------------------------------------
 * 默认值：20

微迭代的最大步数，适用于精确二阶方法（Werner）和近似二阶方法（Quasi）。

:guilabel:`Mocit` 参数类型：整型
------------------------------------------------
设置iCAS微迭代的步数。

:guilabel:`CIiter` 参数类型：整型
------------------------------------------------
 * 默认值：200

CI Davidson迭代的最大步数。

:guilabel:`THRESHMAC` 参数类型：浮点型
------------------------------------------------
 * 默认值：1.d-8

CI优化的收敛阈值。

:guilabel:`THRESORB` 参数类型：浮点型
------------------------------------------------
 * 默认值：1.d-4

轨道梯度的收敛阈值。

:guilabel:`THRESCUT` 参数类型：浮点型
------------------------------------------------
 * 默认值：0.8

SVD值的阈值，用于衡量上一步轨道和当前轨道的匹配程度。如果SVD值小于此阈值，相应的分子轨道将被自动转出子空间。

:guilabel:`THRESICAS` 参数类型：浮点型
------------------------------------------------
 * 默认值：1.d-4

使用iCAS的阈值。当|E(n)-E(n+1)|大于此阈值时，才进行iCAS计算。

:guilabel:`CMIN` 参数类型：浮点型
------------------------------------------------
 * 默认值：1.d-4

UGA-CI和iCI的CSFs的截断阈值。

:guilabel:`ACTMIN` 参数类型：浮点型
------------------------------------------------
 * 默认值：1.d-6

iCI计算活性空间内分子轨道的Jacobi旋转的阈值。

:guilabel:`ENEONLY` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

MCSCF将在达到CI优化阈值时收敛，不考虑轨道梯度。

:guilabel:`ORBONLY` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

MCSCF将在在达到轨道梯度阈值时收敛，不考虑能量。

:guilabel:`GORBMAX` 参数类型：浮点型
------------------------------------------------
 * 默认值：1.d-4

最大轨道梯度的阈值。

:guilabel:`CSFCRI` 参数类型：浮点型
------------------------------------------------
 * 默认值：5.d-4

MCSCF优化后，将CI系数大于该阈值的CSF输出到$BDF_WORKDIR/BDFTASK.selecsf* 		

:guilabel:`PRTCRI` 参数类型：浮点型
------------------------------------------------
 * 默认值：0.05

MCSCF优化后，CI系数大于该阈值的CSF将打印到$BDF_WORKDIR/BDFTASK.out中。

:guilabel:`PRTITER` 参数类型：Bool型
------------------------------------------------
 * 默认值：False

每次宏迭代后将分子轨道输出至$BDFTASK.mciter.molden。
注意新产生的分子轨道文件将覆盖上一步的。


