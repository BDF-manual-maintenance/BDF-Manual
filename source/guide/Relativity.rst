
.. _relativity:

相对论效应
================================================
相对论效应主要包括标量相对论效应和旋轨耦合作用两部分。
相对论效应在有机发光机理研究十分重要，例如旋轨耦合作用导致电子态发生系间窜跃，以及过渡态、产物的自旋发生改变。
原子最内层的芯电子一方面受相对论效应的影响最强，另一方面对化学变化不敏感，因此有不同的处理方式，主要有全电子相对论和有效芯势（ECP）两类方法。

1. **全电子方法** 所有的内层电子均做变分处理。常见的全电子相对论哈密顿量有：零阶正则近似（ZORA），二阶Douglas-Kroll-Hess（DKH2），
刘文剑等人提出的精确二分量（X2C），等。ZORA和DKH2在精度和效率上没有优势，不建议使用。

2. **ECP** 重原子的芯层电子用事先拟合好的有效势函数替代。当重原子较多的情况下，ECP能够大幅降低变分自由度，提高计算效率。根据价电子波函数在芯层有无节点，
ECP又分为赝势（PP）和模型芯势（MCP）两大类，其中MCP为了正确地重现价电子波函数节点，必须结合大量的高斯函数，导致计算效率的提升不明显，因此应用较少。
BDF程序中的ECP均指PP。

BDF基组库提供大量的 :ref:`全电子相对论基组<all-e-bas>` 和 :ref:`ECP基组<ecp-bas>` 。

.. warning::

    1. X2C哈密顿与ECP基组不要混用
    2. X2C相对论计算必须采用非收缩基组或专门优化的收缩基组，但前18号元素不强求


标量相对论效应
------------------------------------------------

* **全电子方法**

BDF可以通过无自旋X2C哈密顿（sf-X2C）及其局域近似变体sf-X2C-AXR、sf-X2C-AU，考虑标量相对论效应。例如：

.. code-block:: bdf

  $xuanyuan
  heff
   23
  nuclear
    1
  $end

在以上输入中， ``heff`` 调用标量相对论哈密顿，如sf-X2C（3，4，或21），sf-X2C-AXR（原子X矩阵近似，22），
sf-X2C-AU（原子U变换近似，23），其中21，22，23具有解析导数。

.. _finite-nuclear:

``nuclear`` 选项设为1表示使用有限核模型，一般不是必须的。但是有些相对论收缩基组考虑了原子核尺寸效应（如ANO-R），或者当计算原子核附近的电子性质时，这些情况下要使用有限核模型。

那么，sf-X2C和它的变体之间有什么区别呢？
sf-X2C通过严格求解分子的单电子无自旋Dirac方程来获得 **X** 矩阵，是标准做法；当基函数个数超过1000以后，对角化步骤成为计算瓶颈。
sf-X2C-AXR和sf-X2C-AU巧妙利用了 **X** 矩阵的原子局域性，只需对原子的各个L壳层分别求解维度很小的Dirac方程，得到一些小 **X** 矩阵，再拼合出分子的大 **X** 矩阵，因此大大降低了计算量。
基函数个数超过2000以后， **R** 矩阵的计算也存在类似的问题，sf-X2C-AU利用了 **R** 矩阵的原子局域性（不过对于超重元素，这一近似略显粗糙），
效率高于严格计算分子 **R** 矩阵的sf-X2C-AXR。 :cite:`doi:10.1021/acs.jctc.9b01120` 
因此，对于不涉及5d以上重元素—重元素成键的分子体系，sf-X2C-AU具有最高的效率且不损失精度，是推荐方法。否则用sf-X2C（小分子）或sf-X2C-AXR（大小分子均可）。

.. warning::

    ``heff`` = 21，22，23时，程序优先从 :ref:`BDF_TMPDIR<run-bdfpro>` 目录下的临时文件中读取解析导数所需的数据，如果临时文件是其它计算产生的，可能会导致错误结果！
    此时必须使用空的BDF_TMPDIR目录进行计算，除非原子排序、坐标、基组在两个计算中完全一致。

* **ECP**

ECP必须与非相对论哈密顿相结合，相对论效应隐含在赝势参数中。

.. important::

   * sf-X2C及其局域变体支持的计算类型有：单点能，解析梯度和结构优化，以及部分 :ref:`一阶单电子性质<1e-prop>` 。解析Hessian和二阶单电子性质正在开发中。
   * ECP支持的计算类型有：单点能，解析梯度和结构优化，以及部分 :ref:`单电子性质<1e-prop>` 。ECP的解析Hessian正在开发中。

旋轨耦合作用
------------------------------------------------
BDF可以通过态相互作用（SI）方法，在TDDFT单点计算中处理不同自旋多重度电子态之间的自旋轨道耦合。需要在 ``xuanyuan`` 模块中通过
``hsoc`` 关键词指定如何计算自旋轨道积分。参见 :ref:`TDDFT<TD>` 部分的示例。
关于在化学反应模拟中近似考虑旋轨耦合，参见 :ref:`自旋混合态<MultiStateMix>` 计算。

根据采用的哈密顿的不同，自旋轨道耦合也可分为全电子和ECP两类。

* **全电子方法**

虽然双电子自旋轨道积分的贡献小于单电子自旋轨道积分，但是对旋轨耦合作用的影响可能达到1/5~1/3，因此不能忽略。
建议采用单电子自旋轨道积分+单中心近似的分子平均场双电子自旋轨道积分（so1e + SOMF-1c； ``hsoc`` = 2）。
它可以与sf-X2C标量相对论哈密顿结合，对于轻元素体系也可以与非相对论哈密顿结合。
此外，还可以对单电子自旋轨道积分进行屏蔽原子核 :cite:`snso2000,msnso2013` 或有效核电荷 :cite:`zeff1995` 校正，近似考虑双电子自旋轨道积分的影响，但是这对芯层轨道性质可能会造成无法预料的误差。

.. _so1e-zeff:

* **ECP**

包括两种处理方法：

1. 旋轨耦合赝势，适用于SOECP描述的原子。需要在标量ECP中加入额外的SO势函数（SOECP；见基组库中的 :ref:`旋轨耦合赝势基组 <soecp-bas>` ）。
2. 有效核电荷 :cite:`zeff1995,zeff1998` ，适用于标量ECP描述的原子，以及用非相对论全电子基组描述的原子，但是支持的原子类型有限（见下）。

由于双电子自旋轨道相互作用的影响已经包含在SO势的拟合参数或有效核电荷的经验参数中，只要计算单电子自旋轨道积分即可。
根据每个原子的基组是否包含SOECP，BDF可以分别使用以上两种处理方法，只需要在 :ref:`xuanyuan<xuanyuan>` 模块中设定 ``hsoc`` 为10。

需要注意的是，有效核电荷支持的元素和基组类型有限。对于全电子基组，仅支持Xe之前的主族元素，且较重的稀有气体元素Ne、Ar、Kr除外。
对于标量ECP基组，虽然支持的元素更多，但是ECP的芯电子数（NCore）必须与下表一致；

.. table:: 有效核电荷支持的标量ECP基组芯电子数以及原子
    :widths: auto

    +-----------------------------+----------------------------------------+-------+
    | 原子                        | ZA                                     | NCore |
    +=============================+========================================+=======+
    | Li-F                        | 3- 9                                   | 2     |
    +-----------------------------+----------------------------------------+-------+
    | Na-Cl, Sc-Cu, Zn, Ga        | 11-17, 21-29, 30, 31                   | 10    |
    +-----------------------------+----------------------------------------+-------+
    | K -Ca                       | 19-20                                  | 18    |
    +-----------------------------+----------------------------------------+-------+
    | Ge-Br, Y -Ag, Cd, In        | 32-35, 39-47, 48, 49                   | 28    |
    +-----------------------------+----------------------------------------+-------+
    | Rb-Sr                       | 37-38                                  | 36    |
    +-----------------------------+----------------------------------------+-------+
    | Sn-I, La                    | 50-53, 57                              | 46    |
    +-----------------------------+----------------------------------------+-------+
    | Cs-Ba                       | 55-56                                  | 54    |
    +-----------------------------+----------------------------------------+-------+
    | Hf-Au, Hg, Tl               | 72-79, 80, 81                          | 60    |
    +-----------------------------+----------------------------------------+-------+
    | Pb-At                       | 82-85                                  | 78    |
    +-----------------------------+----------------------------------------+-------+

更多细节，如Zeff参数、参考文献等，见soint_util/zefflib.F90。如果有效核电荷方法用于不支持的元素或基组，旋轨耦合计算的结果不可靠。

