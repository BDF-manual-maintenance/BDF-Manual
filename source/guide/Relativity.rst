
.. _relativity:

相对论效应
================================================
相对论效应主要包括标量相对论效应和旋轨耦合作用两部分。
相对论效应在有机发光机理研究十分重要，例如旋轨耦合作用导致电子态发生系间蹿跃，以及过渡态、产物的自旋发生改变。
原子最内层的芯电子一方面受相对论效应的影响最强，另一方面对化学变化不敏感，因此有不同的处理方式，主要有全电子相对论和有效芯势（ECP）两类方法。

1. **全电子方法** 所有的内层电子均做变分处理。常见的全电子相对论哈密顿量有：零阶正则近似（ZORA），二阶Douglas-Kroll-Hess（DKH2），
刘文剑等人提出的精确二分量（X2C），等。ZORA和DKH2在精度和效率上没有优势，不建议使用。

2. **ECP** 重原子的芯层电子用事先拟合好的有效势函数替代。当重原子较多的情况下，ECP能够大幅降低变分自由度，提高计算效率。根据价电子波函数在芯层有无节点，
ECP又分为赝势（PP）和模型芯势（MCP）两大类，其中MCP为了正确地重现价电子波函数节点，必须结合大量的高斯函数，导致计算效率的提升不明显，因此应用较少。
BDF程序中的ECP均指PP。

BDF基组库提供大量的 :ref:`全电子相对论基组<all-e-bas>` 和 :ref:`ECP基组<ecp-bas>` 。

.. warning::

    1. X2C哈密顿与ECP基组不要混用
    2. X2C相对论计算必须采用非收缩基组或专门优化的收缩基组，但前18号元素不强求


标量相对论效应
------------------------------------------------

* **全电子方法**

BDF可以通过无自旋X2C哈密顿（sf-X2C）及其局域近似变体sf-X2C-AXR、sf-X2C-AU，考虑标量相对论效应。例如：

.. code-block:: bdf

  $xuanyuan
  scalar
  heff
   23
  nuclear
    1
  $end

在以上输入中， ``scalar`` 调用标量相对论哈密顿，具体类型用 ``heff`` 指定，如sf-X2C（ ``heff`` 为3或21），sf-X2C-AXR（原子X矩阵近似， ``heff`` 为22），
sf-X2C-AU（原子U变换近似， ``heff`` 为23），其中21，22，23具有解析导数。
对于不涉及5d以上重元素—重元素成键的分子体系，sf-X2C-AU具有最高的效率且不损失精度，是推荐方法。否则用sf-X2C-AXR。

.. _finite-nuclear:

``nuclear`` 选项设为1表示使用有限核模型，一般不是必须的。但是有些相对论收缩基组考虑了原子核尺寸效应，或者当计算原子核附近的电子性质时，这些情况下要使用有限核模型。
对于110号（Ds）之前的元素，均方根（RMS）核半径取自Visscher和Dyall汇总的数据 :cite:`visscher1997` ；
从Ds元素开始，RMS核半径通过核素质量A估算（单位：费米）：

.. math::
   \left<r^2\right> \approx 0.57 + 0.836 \, A^{1/3}

其中的核素质量A与核电荷数Z近似满足以下关系 :cite:`andrae2000,andrae2002` ：

.. math::
   A \approx 0.004467 \, Z^2 + 2.163 \, Z - 1.168

BDF支持的sf-X2C计算类型有：单点能，结构优化，以及部分 :ref:`一阶单电子性质<1e-prop>` 。解析Hessian和二阶单电子性质正在开发中。

* **ECP**

ECP必须与非相对论哈密顿相结合，相对论效应隐含在赝势参数中。
BDF支持的ECP计算类型有：单点能以及部分 :ref:`单电子性质<1e-prop>` 。ECP的梯度和Hessian正在开发中。

旋轨耦合作用
------------------------------------------------
BDF可以通过态相互作用（SI）方法，在TDDFT单点计算中处理不同自旋多重度电子态之间的自旋轨道耦合。需要在 ``xuanyuan`` 模块中通过
``soint`` 关键词指定如何计算自旋轨道积分。参见TDDFT部分的示例。

根据采用的哈密顿的不同，自旋轨道耦合也可分为全电子和ECP两类。

* **全电子方法**

建议采用单电子自旋轨道积分+单中心近似的分子平均场双电子自旋轨道积分（so1e + somf-1c）。它可以与X2C标量相对论哈密顿结合，
对于轻元素体系也可以与非相对论哈密顿结合。

* **ECP**

包括两种处理方法：(1) 旋轨耦合赝势，需要在标量ECP中加入额外的SO势函数（SOECP；见基组库中的 :ref:`旋轨耦合赝势基组 <soecp-bas>` ），
以及 (2) 有效核电荷。由于双电子自旋轨道相互作用的影响已经包含在SO势的拟合参数或有效核电荷的经验参数中，
只要计算单电子自旋轨道积分（so1e）即可。示例：

.. code-block:: bdf

  $xuanyuan
  soint
  hsoc
    0
  $end

