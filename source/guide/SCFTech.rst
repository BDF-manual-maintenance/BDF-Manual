自洽场计算的其它技巧
=====================================

自洽场计算的初始猜测
------------------------------------------------
自洽场计算的初始猜测轨道，对计算的收敛性有很大的影响。BDF支持多种初始猜测，如下所示：

  * Atom : 利用原子密度矩阵组合分子密度矩阵猜测，默认选项。
  * Huckel : 半经验Huckel方法猜测；
  * Hcore : 对角化单电子哈密顿猜测；
  * Readmo : 读入分子轨道做为初始猜测；
  * Readdm : 读入密度矩阵做为初始猜测。

BDF默认的是Atom猜测。改变BDF的初始猜测，简洁输入模式下可以使用关键词 ``guess`` , 如下所示

.. code-block:: bdf

    #! ch3cho.sh
    HF/6-31G guess=Hcore unit=Bohr
    
    geometry    # notice: unit in Bohr 
    C       0.1727682300       -0.0000045651       -0.8301598059
    C      -2.3763311896        0.0000001634        0.5600567139
    H       0.0151760290        0.0000088544       -2.9110013387
    H      -2.0873396672        0.0000037621        2.5902220967
    H      -3.4601725077       -1.6628370597        0.0320271859
    H      -3.4601679801        1.6628382651        0.0320205364
    O       2.2198078005        0.0000024315        0.2188182082
    end geometry

这里，我们在第二行是用了关键词 ``guess=Hcore`` 指定使用 ``Hcore`` 猜测。SCF迭代了18次收敛。

.. code-block:: 

  Iter. idiis vshift  SCF Energy    DeltaE     RMSDeltaD    MaxDeltaD   Damping Times(S) 
   1    0   0.000 -130.488739529 174.680929376  0.401531162  5.325668770  0.0000   0.03
   2    1   0.000 -115.595786784  14.892952744  0.407402695  5.323804678  0.0000   0.02
   3    2   0.000 -126.823748834 -11.227962049  0.115300517  1.591646800  0.0000   0.03
   4    3   0.000 -150.870636785 -24.046887951  0.011394798  0.154813426  0.0000   0.02
   5    4   0.000 -151.121829169  -0.251192384  0.004498398  0.037875784  0.0000   0.03
   6    5   0.000 -150.900123989   0.221705180  0.008483436  0.119865266  0.0000   0.02
   7    6   0.000 -151.582006133  -0.681882144  0.011892345  0.122063906  0.0000   0.02
   8    7   0.000 -152.441656890  -0.859650757  0.007907887  0.062113717  0.0000   0.03
   9    8   0.000 -152.729229838  -0.287572947  0.003318529  0.037884676  0.0000   0.02
  10    2   0.000 -152.795374919  -0.066145081  0.005951772  0.054625652  0.0000   0.02
  11    3   0.000 -152.839276725  -0.043901806  0.000860488  0.010210210  0.0000   0.03
  12    4   0.000 -152.841131472  -0.001854746  0.000733951  0.007678730  0.0000   0.02
  13    5   0.000 -152.841752921  -0.000621449  0.000348937  0.003519950  0.0000   0.02
  14    6   0.000 -152.841816238  -0.000063316  0.000053288  0.000787592  0.0000   0.03
  15    7   0.000 -152.841819180  -0.000002942  0.000021206  0.000157533  0.0000   0.02
  16    8   0.000 -152.841819505  -0.000000325  0.000004796  0.000031694  0.0000   0.02
  17    2   0.000 -152.841819522  -0.000000016  0.000000698  0.000005497  0.0000   0.03
  18    3   0.000 -152.841819522  -0.000000000  0.000000236  0.000002276  0.0000   0.02
 diis/vshift is closed at iter =  18
  19    0   0.000 -152.8418195227 -0.000000000  0.000000078  0.000000848  0.0000   0.03

.. warning:: 
   这个算例分子输入坐标的单位是Bohr，必须使用关键词 ``unit=Bohr`` 指定坐标的长度单位为 ``Bohr`` 。

这个算例对应的高级输入为

.. code-block:: bdf

   $compass
   geometry
     C 0.1727682300 -0.0000045651 -0.8301598059
     C -2.3763311896 0.0000001634 0.5600567139
     H 0.0151760290 0.0000088544 -2.9110013387
     H -2.0873396672 0.0000037621 2.5902220967
     H -3.4601725077 -1.6628370597 0.0320271859
     H -3.4601679801 1.6628382651 0.0320205364
     O 2.2198078005 0.0000024315 0.2188182082
   end geometry
   skeleton
   unit # set unit of coordinates as Bohr
     bohr
   basis
     6-31g
   $end

   $xuanyuan
   direct
   maxmem
   512mw
   $end

   $scf
   rhf
   guess # ask for hcore guess
     hcore
   $end

读入初始猜测轨道
------------------------------------------------------------------------------------------
BDF的SCF计算默认采用原子计算密度矩阵构建分子密度矩阵的方式产生初始猜测轨道。实际在计算中，用户常读入其他已收敛scf计算分子轨道，做为计算的初始猜测。本算例，我们先计算一个中性的 :math:`\ce{H2O}` 分子，得到收敛轨道后，做为 :math:`\ce{H2O+}` 离子的初始猜测。

第一步，计算 :math:`\ce{H2O}` 分子, 准备输入文件，并命名为 ``h2o.inp`` , 内容如下：

.. code-block:: bdf

    #!bdf.sh
    RKS/B3lyp/cc-pvdz     
    
    geometry
    O
    H  1  R1
    H  1  R1  2 109.
    
    R1=1.0     # OH bond length in angstrom 
    end geometry

执行计算后，工作目录生成可读文件 ``h2o.scforb`` ，保存了SCF计算收敛的轨道.


第二步，利用 :math:`\ce{H2O}` 分子的收敛轨道做为 :math:`\ce{H2O+}` 离子的初始猜测, 准备输入文件 h2o+.inp, 内容如下：

.. code-block:: bdf

    #!bdf.sh
    ROKS/B3lyp/cc-pvdz guess=readmo charge=1
    
    geometry
    O
    H  1  R1
    H  1  R1  2 109.
    
    R1=1.0     # OH bond length in angstrom
    end geometry
    
    %cp $BDF_WORKDIR/h2o.scforb $BDF_TMPDIR/${BDFTASK}.inporb


这里，使用了关键词 ``guess=readmo`` ，指定要读入初始猜测轨道。初始猜测轨道是用 ``%`` 引导的拷贝命令从
环境变量 ``BDF_WORKDIR`` 定义的文件夹中的h2o.scforb复制为 ``BDF_TMPDIR`` 中的 ``${BDFTASK}.inporb`` 文件。
这里， ``BDF_WORKDIR`` 是执行计算任务的目录， ``BDF_TMPDIR`` 是BDF存储临时文件的目录。


扩展小基组收敛轨道为大基组初始猜测
------------------------------------------------
扩展小基组计算的收敛轨道为大基组的收敛轨道可以加速计算收敛，一般的，基组扩展应该采用同组的轨道，如cc-pVXZ系列的，ANO-RCC系列的等。
目前，不同基组的扩展轨道只支持BDF的高级输入模式。对于 :math:`\ce{CH3CHO}` 分子，先用cc-pVDZ计算，然后将轨道扩展为cc-pVQZ基组计算的初始猜测轨道，
输入如下：

.. code-block:: bdf

    # First SCF calculation using small basis set cc-pvdz
    $compass
    geometry
    C       0.1727682300       -0.0000045651       -0.8301598059
    C      -2.3763311896        0.0000001634        0.5600567139
    H       0.0151760290        0.0000088544       -2.9110013387
    H      -2.0873396672        0.0000037621        2.5902220967
    H      -3.4601725077       -1.6628370597        0.0320271859
    H      -3.4601679801        1.6628382651        0.0320205364
    O       2.2198078005        0.0000024315        0.2188182082
    end geometry
     skeleton
    basis
     cc-pvdz
    unit # set unit of coordinates as Bohr
     Bohr
    $end
     
    $xuanyuan
    direct
    $end
     
    $scf
    rhf
    $end
    
    #change chkfil name into chkfil1
    %mv $BDF_WORKDIR/$BDFTASK.chkfil $BDF_WORKDIR/$BDFTASK.chkfil1
    
    $compass
    geometry
    C       0.1727682300       -0.0000045651       -0.8301598059
    C      -2.3763311896        0.0000001634        0.5600567139
    H       0.0151760290        0.0000088544       -2.9110013387
    H      -2.0873396672        0.0000037621        2.5902220967
    H      -3.4601725077       -1.6628370597        0.0320271859
    H      -3.4601679801        1.6628382651        0.0320205364
    O       2.2198078005        0.0000024315        0.2188182082
    end geometry
     skeleton
    basis
     cc-pvqz
    unit
     Bohr
    $end
    
    #change chkfil name into chkfil1. notice, should use cp command since we will use "$BDFTASK.chkfil" in next calculation
    %cp $BDF_WORKDIR/$BDFTASK.chkfil $BDF_WORKDIR/$BDFTASK.chkfil2
    
    #copy converge SCF orbital as input orbital of the module expandmo
    %cp $BDF_WORKDIR/$BDFTASK.scforb $BDF_WORKDIR/$BDFTASK.inporb
    
    #Expand orbital to large basis set, output file is $BDFTASK.exporb
    $expandmo
    overlap
    $end
     
    $xuanyuan
    Direct
    $end
    
    #use expanded orbital as initial guess orbital
    %cp $BDF_WORKDIR/$BDFTASK.exporb $BDF_WORKDIR/$BDFTASK.scforb
    $scf
    RHF
    guess
     readmo
    iprtmo
     2
    $end

上面的输入中，先执行使用了 **cc-pVDZ** 基组第一个RHF计算，然后利用 expandmo 模块，将第一次 SCF 计算的收敛轨道扩展到 **cc-pVQZ** 基组，
最后做为利用 guess=readmo 做为SCF的要读入的初始猜测轨道。

expandmo模块的输出为，

.. code-block:: 

    |******************************************************************************|
    
        Start running module expandmo
        Current time   2021-11-29  22:20:50
    
    |******************************************************************************|
     $expandmo                                                                                                                                                                                                                                                       
     overlap                                                                                                                                                                                                                                                         
     $end                                                                                                                                                                                                                                                            
     /Users/bsuo/check/bdf/bdfpro/ch3cho_exporb.chkfil1
     /Users/bsuo/check/bdf/bdfpro/ch3cho_exporb.chkfil2
     /Users/bsuo/check/bdf/bdfpro/ch3cho_exporb.inporb
      Expanding MO from small to large basis set or revise ...
    
     1 Small basis sets
    
     Number of  basis functions (NBF):      62
     Maxium NBF of shell :        6
    
     Number of basis functions of small basis sets:       62
    
     2 Large basis sets
    
     Number of  basis functions (NBF):     285
     Maxium NBF of shell :       15
    
      Overlap expanding :                     1
     Read guess orb
     Read orbital title:  TITLE - SCF Canonical Orbital
    nsbas_small  62
    nsbas_large 285
    ipsmall   1
    iplarge   1
      Overlap of dual basis ...
      Overlap of large basis ...
     Write expanded MO to scratch file ...
    |******************************************************************************|
    
        Total cpu     time:          0.42  S
        Total system  time:          0.02  S
        Total wall    time:          0.47  S
    
        Current time   2021-11-29  22:20:51
        End running module expandmo
    |******************************************************************************|

可以看出，小基组有62个轨道，大基组有285个轨道，expandmo读入了SCF收敛的正则轨道，扩展到大基组并写入临时文件。

第二次SCF计算的输出为，

.. code-block:: 

    /Users/bsuo/check/bdf/bdfpro/ch3cho_exporb.scforb
    Read guess orb:  nden=1  nreps= 1  norb=  285  lenmo=  81225
    Read orbital title:  TITLE - orthognal Expand CMO
    Orbitals initialization is completed.
 
    ........
  Iter. idiis vshift  SCF Energy    DeltaE     RMSDeltaD    MaxDeltaD   Damping Times(S) 
   1    0   0.000 -152.952976892 122.547522034  0.002218985  0.246735859  0.0000  16.30
   2    1   0.000 -152.983462881  -0.030485988  0.000367245  0.026196100  0.0000  16.83
   3    2   0.000 -152.983976045  -0.000513164  0.000086429  0.006856831  0.0000  17.18
   4    3   0.000 -152.984012062  -0.000036016  0.000016763  0.001472939  0.0000  17.02
   5    4   0.000 -152.984019728  -0.000007666  0.000010400  0.001012788  0.0000  17.42
   6    5   0.000 -152.984021773  -0.000002045  0.000003396  0.000328178  0.0000  17.28
   7    6   0.000 -152.984022197  -0.000000423  0.000001082  0.000075914  0.0000  17.40
   8    7   0.000 -152.984022242  -0.000000044  0.000000154  0.000008645  0.0000  17.28
   9    8   0.000 -152.984022243  -0.000000001  0.000000066  0.000005087  0.0000  19.38
    diis/vshift is closed at iter =   9
      10      0    0.000    -152.9840222436      -0.0000000001       0.0000000072       0.0000005845    0.0000     18.95
    
      Label              CPU Time        SYS Time        Wall Time
     SCF iteration time:       517.800 S        0.733 S      175.617 S


指定占据数计算激发态
------------------------------------------------


.. _momMethod:

分子轨道最大占据数(mom)方法计算激发态
------------------------------------------------
mom(maximum occupation method)是一种ΔSCF方法，可用于计算激发态。
                                    
.. code-block:: bdf

    #----------------------------------------------------------------------
    # 
    # mom method: J. Liu, Y. Zhang, and W. Liu, J. Chem. Theory Comput. 10, 2436 (2014).
    #
    # gs  = -169.86584128
    # ab  = -169.62226127
    # T   = -169.62483480
    # w(S)= 6.69eV
    #----------------------------------------------------------------------
    $COMPASS 
    Title
     mom
    Basis
     6-311++GPP
    Geometry
     C       0.000000    0.418626    0.000000
     H      -0.460595    1.426053    0.000000
     O       1.196516    0.242075    0.000000
     N      -0.936579   -0.568753    0.000000
     H      -0.634414   -1.530889    0.000000
     H      -1.921071   -0.362247    0.000000
    End geometry
    Check
    $END
    
    $XUANYUAN
    $END
    
    $SCF
    UKS
    DFT
    B3LYP
    alpha
      10 2
    beta
      10 2
    $END
    
    %cp ${BDFTASK}.scforb $BDF_TMPDIR/${BDFTASK}.inporb

    # delta scf with mom
    $SCF
    UKS
    DFT
    B3LYP
    guess
     readmo
    alpha
     10 2
    beta
     10 2
    ifpair
    hpalpha
     1
     10 0 
     11 0 
    iaufbau
     2
    $END
   
    # pure delta scf for triplet
    $SCF
    UKS
    DFT
    B3LYP
    alpha
      11 2
    beta
      9 2
    iaufbau
      0
    $END

这个算例执行了三次SCF计算，

* 第一次SCF，利用UKS方法计算甲酰胺分子的基态S0。输入利用alpha与beta两个关键词，分别指定了alpha和beta轨道的占据情况。甲酰胺分子基态是单重态S0，这里指定的alpha和beta占据情况相同。 ``10 2`` 分别指定不可约表示A‘与A“的轨道分别有10个和2个占据。SCF模块将根据构造原理，按照轨道能量由低到高填充电子到轨道上。
* 第二次SCF，利用UKS与mom方法计算甲酰胺分子的S1态。这里的关键点有：1 利用guess=readmo指定读入上一步UKS的收敛轨道；2 利用alpha、beta关键词设置了每个对称性轨道的占据数；3 设置了变量ifpair，需要和hpalpha，hpbeta联用，用于指定空穴-粒子（hole-particle - HP）轨道对的电子激发情况；4 设置了hpalpha变量，指定激发的HP轨道对。数字1表示激发一对HP轨道，下面指定两行指定轨道激发情况，第一列表示从第一个不可约表示的把第10个alpha轨道的电子激发到第11个alpha轨道，第二列元素都为零，表示第二个不可约表示的轨道不做激发； 5 iaufbau变量设置为2，指定要进行mom计算。
* 第三次SCF，利用UKS与mom方法计算甲酰胺分子的T1态。输入中，我们利用alpha和beta关键词指定轨道占据情况，其中alpha轨道的占据数为 ``11 2`` ，表示对称性为A‘和A“的alpha轨道上分别有11和2个电子占据， beta轨道的占据情况为 ``9 2`` 。 iaufbau=0表示轨道占据按照构造原理由低到高排列。

这里，第一次SCF计算收敛结果为，

.. code-block:: 

     Superposition of atomic densities as initial guess.
     skipaocheck T F
     Solve HC=EC in pflmo space. F       12       75
     Initial guess energy =   -169.2529540680
    
     [scf_cycle_init_ecdenpot]
    Meomory for coulpotential         0.00  G
    
     Start SCF iteration......
    
    
    Iter.   idiis  vshift       SCF Energy            DeltaE          RMSDeltaD          MaxDeltaD      Damping    Times(S) 
       1      0    0.000    -169.4117392632      -0.1587851952       0.0057009284       0.1638225603    0.0000      0.20
      Turn on DFT calculation ...
       2      1    0.000    -169.7431751196      -0.3314358564       0.0089053494       0.3408158866    0.0000      0.42
       3      2    0.000    -169.2323336602       0.5108414595       0.0068957960       0.2967887103    0.0000      0.43
       4      3    0.000    -169.8634051428      -0.6310714827       0.0003649996       0.0157329118    0.0000      0.43
       5      4    0.000    -169.8633458472       0.0000592957       0.0002097712       0.0092058786    0.0000      0.42
       6      5    0.000    -169.8658113019      -0.0024654548       0.0000273256       0.0006069094    0.0000      0.43
       7      6    0.000    -169.8658319536      -0.0000206516       0.0000080394       0.0003577265    0.0000      0.43
       8      7    0.000    -169.8658331999      -0.0000012463       0.0000039274       0.0001143119    0.0000      0.42
       9      8    0.000    -169.8658334018      -0.0000002019       0.0000001820       0.0000043995    0.0000      0.43
     diis/vshift is closed at iter =   9
      10      0    0.000    -169.8658334023      -0.0000000004       0.0000001387       0.0000038845    0.0000      0.43
    
      Label              CPU Time        SYS Time        Wall Time
     SCF iteration time:         8.650 S        0.700 S        4.050 S
    
     Final DeltaE =  -4.4343551053316332E-010
     Final DeltaD =   1.3872600382452641E-007   5.0000000000000002E-005
    
     Final scf result
       E_tot =              -169.86583340
       E_ele =              -241.07729109
       E_nn  =                71.21145769
       E_1e  =              -371.80490197
       E_ne  =              -541.14538673
       E_kin =               169.34048477
       E_ee  =               148.48285541
       E_xc  =               -17.75524454
      Virial Theorem      2.003102

可以看出，第一次SCF计算使用了atom猜测，计算得到S0的能量为 -169.8658334023 a.u. 。第二次SCF计算读入了第一次SCF的收敛轨道，
并使用mom方法做SCF计算，输出文件先提示读入了分子轨道，并给出占据情况，

.. code-block::

      [Final occupation pattern: ]

   Irreps:        A'      A'' 
  
   detailed occupation for iden/irep:      1   1
      1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00
   detailed occupation for iden/irep:      1   2
      1.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00
   Alpha      10.00    2.00

这里， ``A‘`` 表示的第10个alpha轨道是占据轨道，第11个轨道是空轨道。第二次SCF计算读入了第一次SCF的收敛轨道，并使用mom方法做SCF计算，输入中要求将 ``A‘`` 表示的第10个轨道的电子激发到第11个轨道上。输出文件先提示读入了分子轨道，并给出占据情况，

.. code-block:: 

   Read initial orbitals from user specified file.
  
   /tmp/20117/mom_formamide.inporb
   Read guess orb:  nden=2  nreps= 2  norb=   87  lenmo=   4797
   Read orbital title:  TITLE - SCF Canonical Orbital
  
   Initial occupation pattern: iden=1  irep= 1  norb(irep)=   66
      1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 0.00
      1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00
  
  
   Initial occupation pattern: iden=1  irep= 2  norb(irep)=   21
      1.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00
  
  
   Initial occupation pattern: iden=2  irep= 1  norb(irep)=   66
      1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00
  
  
   Initial occupation pattern: iden=2  irep= 2  norb(irep)=   21
      1.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
      0.00
    
这里，iden=1为alpha轨道，irep=1指第一个不可约表示，总共有norb=66个轨道，其中，第10个轨道的占据数为0.00，第11个轨道占据数为1.00。经14次SCF迭代，收敛的S1态能量为 -169.6222628003 a.u.,如下所示：

.. code-block:: 
    
    Iter.   idiis  vshift       SCF Energy            DeltaE          RMSDeltaD          MaxDeltaD      Damping    Times(S) 
       1      0    0.000    -169.5056320703     125.0315786109       0.0204280318       1.4631744569    0.0000      0.45
       2      1    0.000    -169.0346457739       0.4709862964       0.0369135222       1.5622848311    0.0000      0.43
       3      2    0.000    -165.7508628922       3.2837828818       0.0321627828       1.5164809905    0.0000      0.43
       4      3    0.000    -169.5606786102      -3.8098157181       0.0085888666       0.8078594190    0.0000      0.43
       5      4    0.000    -169.5962110215      -0.0355324113       0.0038876216       0.3673910291    0.0000      0.42
       6      5    0.000    -169.6201285183      -0.0239174968       0.0018260501       0.1724560038    0.0000      0.43
       7      6    0.000    -169.6219767251      -0.0018482068       0.0004867633       0.0446305277    0.0000      0.43
       8      7    0.000    -169.6222451160      -0.0002683910       0.0001137187       0.0049800353    0.0000      0.43
       9      8    0.000    -169.6222612694      -0.0000161533       0.0001122611       0.0097159054    0.0000      0.42
      10      2    0.000    -169.6222625537      -0.0000012843       0.0000435856       0.0040926685    0.0000      0.42
      11      3    0.000    -169.6222627231      -0.0000001694       0.0000316014       0.0027920757    0.0000      0.42
      12      4    0.000    -169.6222627909      -0.0000000678       0.0000101259       0.0008482973    0.0000      0.43
      13      5    0.000    -169.6222627985      -0.0000000076       0.0000033007       0.0002733399    0.0000      0.43
     diis/vshift is closed at iter =  13
      14      0    0.000    -169.6222628003      -0.0000000018       0.0000011502       0.0000793775    0.0000      0.42
    
      Label              CPU Time        SYS Time        Wall Time
     SCF iteration time:        13.267 S        0.983 S        6.000 S
    
     Final DeltaE =  -1.8403909507469507E-009
     Final DeltaD =   1.1501625138328933E-006   5.0000000000000002E-005
    
     Final scf result
       E_tot =              -169.62226280
       E_ele =              -240.83372049
       E_nn  =                71.21145769
       E_1e  =              -368.54021347
       E_ne  =              -537.75897296
       E_kin =               169.21875949
       E_ee  =               145.28871749
       E_xc  =               -17.58222451
      Virial Theorem      2.002385
    
    
     [Final occupation pattern: ]
    
     Irreps:        A'      A'' 
    
     detailed occupation for iden/irep:      1   1
        1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 0.00
        1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
        0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
        0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
        0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
        0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
        0.00 0.00 0.00 0.00 0.00 0.00
    
SCF收敛后，轨道占据情况被再一次打印，可以看到 **alpha** 轨道中 ``À'``  不可约表示的第10个轨道没有电子占据，第11个轨道有一个电子占据。

第三个SCF计算给出了 **T1** 态能量，为 -169.6248370697 a.u., 输出如下：

.. code-block:: 

    Iter.   idiis  vshift       SCF Energy            DeltaE          RMSDeltaD          MaxDeltaD      Damping    Times(S) 
      1      0    0.000    -169.4117392632      -0.1587851952       0.0838214772       9.1411822251    0.0000      0.17
     Turn on DFT calculation ...
      2      1    0.000    -169.4805494747      -0.0688102115       0.0667003189       6.9787289199    0.0000      0.40
      3      2    0.000    -169.2777356732       0.2028138015       0.0147781901       0.6481839231    0.0000      0.42
      4      3    0.000    -169.6139911960      -0.3362555228       0.0059239090       0.6218433482    0.0000      0.42
      5      4    0.000    -169.6200967789      -0.0061055829       0.0019671687       0.1645061608    0.0000      0.40
      6      5    0.000    -169.6236369993      -0.0035402204       0.0027228126       0.2464256399    0.0000      0.42
      7      6    0.000    -169.6247045144      -0.0010675151       0.0010645369       0.0981387987    0.0000      0.42
      8      7    0.000    -169.6248148827      -0.0001103684       0.0005254362       0.0463928617    0.0000      0.42
      9      8    0.000    -169.6248345200      -0.0000196373       0.0001792341       0.0129666418    0.0000      0.42
     10      2    0.000    -169.6248366947      -0.0000021747       0.0000638232       0.0049022763    0.0000      0.42
     11      3    0.000    -169.6248369221      -0.0000002274       0.0000178310       0.0014400891    0.0000      0.43
     12      4    0.000    -169.6248370255      -0.0000001034       0.0000342439       0.0026188978    0.0000      0.42
     13      5    0.000    -169.6248370654      -0.0000000399       0.0000061583       0.0004660019    0.0000      0.40
     14      6    0.000    -169.6248370686      -0.0000000032       0.0000036155       0.0003542291    0.0000      0.42
    diis/vshift is closed at iter =  14
     15      0    0.000    -169.6248370697      -0.0000000011       0.0000009659       0.0000704036    0.0000      0.42
   
     Label              CPU Time        SYS Time        Wall Time
    SCF iteration time:        13.150 S        0.950 S        5.967 S
   
    Final DeltaE =  -1.1375220765330596E-009
    Final DeltaD =   9.6591808698539483E-007   5.0000000000000002E-005
   
    Final scf result
      E_tot =              -169.62483707
      E_ele =              -240.83629476
      E_nn  =                71.21145769
      E_1e  =              -368.57834907
      E_ne  =              -537.80483706
      E_kin =               169.22648799
      E_ee  =               145.32683246
      E_xc  =               -17.58477815
     Virial Theorem      2.002354



处理自洽场计算的不收敛问题
------------------------------------------------


自洽场计算的加速算法
------------------------------------------------
BDF的一个重要特色是利用 **MPEC+COSX** 方法加速SCF、TDDFT的能量及梯度计算。设置MPEC+COSX计算，输入如下：

.. code-block:: bdf

    #! bdfaccelerate.sh
    HF/cc-pvtz  MPEC+COSX

    geometry

    end geometry

如果是高级输入模式下，只需在COMPASS模块输入中加入关键词 ``MPEC+COSX``，如：

.. code-block:: bdf

    $Compass
    geometry

    end geometry
    basis
      cc-pvdz
    end basis
    MPEC+COSX # ask for the MPEC+COSX method
    $end