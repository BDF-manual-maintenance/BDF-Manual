输入输出格式
************************************

BDF的输入格式
==========================================================================

BDF输入文件格式有三种，分别为：简洁输入（easy input）；高级输入（advanced input）；混合输入（mixed input）。 **简洁输入** 易用性强，用户无需对计算细节太了解，使用门槛低，面向初级用户。 **高级输入** 提供了对BDF计算强大的控制功能，对每个计算模块都可以精确控制。 **混合输入** 是在BDF简洁输入中，添加部分高级输入模式定义的内容。 BDF的高级输入，是希望在保持BDF简洁输入便利、对初学者友好的基础上，通过增加按照高级输入格式定义的、精确控制BDF计算模块行为的字段，来完成一些高级的计算功能。简而言之，BDF的混合输入是BDF简洁输入与高级输入的组合。对于初学者，只需用BDF简洁输入即可完成大多数计算任务。对于有量子化学理论基础，想深入学习和使用BDF更高级的功能，可以学习采用BDF的高级输入。

.. note::

   **输入中除了文件名、shell命令及环境变量外，其他的输入，如BDF的模块名、关键词、值等的输入都不区分大小写字母。**

..


BDF的简洁输入（easy input）
--------------------------------------------------------------------------

以水分子的单点能计算为例来详细描述BDF简洁输入格式：

.. code-block:: bdf

  #!H2O.bdf
  B3lyp/3-21G 

  Geometry  # 输入原子坐标，单位 Angstrom
  O 0.00000    0.00000   0.36827
  H 0.00000   -0.78398   -0.18468
  H 0.00000    0.78398   -0.18468
  End Geometry

- 第一行由#!开始，与Linux中脚本语言约定一样，H2O.bdf是BDF输入文件的名字
- 第二行是BDF的命令行控制行，可以由多行组成，可以用于指定计算方法，基组、泛函、电荷数及自旋多重度的等一些基本的计算控制参数，命令行内容以空格作为间隔分开不同的关键词。
- 第四行开始定义分子的坐标，从Geometry开始，到End Geometry结束。

BDF的高级输入（advanced input）
--------------------------------------------------------------------------

BDF高级输入是开发BDF时设置的输入格式，特点是 **模块引导计算+模块参数控制**，格式如下：

.. code-block:: bdf

    $bdfmodule1
    # Comment
    Keyword1
      value # inline comment
    Keyword2
      value
      ...
    $end

    %cp $BDFTASK.scforb $BDF_TMPDIR/$BDFTASK.inporb 
    $bdfmodule2
    Keyword1
      value
    Keyword2
      value
      ...
    $end

这个输入包含了两个BDF的计算模块，分别为 ``bdfmodule1`` 和 ``bdfmodule2`` （此处仅为举例，并非真的存在名为 ``bdfmodule1`` 和 ``bdfmodule2`` 的模块）, 所谓 **模块引导计算** 指完成该计算将顺序执行两个计算模块。每个模块的输入从 ``$bdfmodule`` 开始，至随后第一次出现的 ``$end`` 关键词结束, ``$bdfmodule`` 与 ``$end`` 之间是该模块的控制关键词及其值。其中 ``bdfmodule`` 是BDF的计算模块名，如 ``compass``, ``xuanyuan`` , ``scf`` 等。所谓 **模块参数控制** 指每个模块通过自有的关键词来控制其计算行为，参数控制输入采用 **关键词+值** 的模式，关键词的值从关键词所在行的下一行开始，根据具体的关键词，可以是单行、也可以是多行。BDF每个计算模块读取并处理自己模块所属的关键词及值。在实际计算中，BDF的简洁输入文件被翻译为BDF的高级输入格式，存储在BDF_ΤΜPDIR指定的临时文件夹中的隐藏文件 **.bdfinput** 中。BDF的高级输入格式需要对量子化学理论有一定了解，也需要知道BDF每个计算模块具体的功能。BDF将不同的计算功能尽可能的独立出来，编译为单独的可执行文件，相当于一个个小工具，然后通过用python语言写的BDF Driver按照计算流程依次调用不同的计算模块来完成复杂的计算任务，各模块之间通过临时文件和环境变量交换数据。


同样，以水分子为例来详细描述BDF高级输入格式：

.. code-block:: bdf

  #Example for BDF advanced input
  $compass
  Title
   Water molecule, energy calculation
  Geometry
  O 0.00000    0.00000   0.36827
  H 0.00000   -0.78398   -0.18468
  H 0.00000    0.78398   -0.18468
  End geometry
  Basis # 基组
   3-21G
  Group # C2v点群，可不输入，程序会自动判断，常用于对高阶群指定D2h及其子群计算。
   C(2v)
  $end

  $xuanyuan
  $end

  $scf
  RHF # restricted Hatree-Fock
  $end

  %cp $BDF_WORKDIR/$BDFTASK.scforb $BDF_TMPDIR/$BDFTASK.inporb
  $scf
  RKS # restricted Kohn-Sham
  DFT
   B3lyp     # B3LYP functional， Notice， it is different with B3lyp in Gaussian. 
  Guess 
   Readmo    # Read orbital from inporb as the initial guess orbital
  $end

一般地，BDF高级输入包含了多个计算模块的输入，具体模块名及调用顺序见BDF模块计算流程图(??)。上面所示的输入文件包含四个计算模块，分别为compass，xuanyuan和两个scf。compass主要用于读入输入分子坐标，基函数等信息，并存储为BDF内部的数据结构。compass的一个重要任务是对分子点群的处理，包括判断分子对称性，产生对称匹配的轨道（symmetry-adapted orbital）等。xuanyuan用于计算单、双电子积分。然后调用两次scf执行自洽场（self-consistent field）计算，一次为RHF（Restricted Hartree-Fock），另一次为RKS（Restricted Kohn-Sham）。


每个计算模块的输入遵循 **“关键词+值”** 的格式，即给出一个关键词，如compass中的Group，紧接着一行为该关键词的值，这里是C(2v)。有的关键词本身即用于逻辑控制，
如第一个scf模块中的RHF，指定scf模块执行RHF计算，这类关键词不需要额外的输入值。而有的关键词的值需要多行输入，具体参见各个模块的关键词说明。



在第一个和第二个scf模块之间，有一个%开头的行。这里，我们插入了一条shell命令，执行一个拷贝文件的任务。将第一个scf计算产生的放在 **BDF_WORKDIR** 中的 **$BDFTASK.scforb** 文件拷贝到 **BDF_TMPDIR** ，并更名为 **$BDFTASK.inporb** 。
在第二个scf模块中，我们指定了关键词guess，值为read，即读入分子轨道作为初始猜测。在BDF高级输入中，以 ``%`` 起始的行为shell命令行，
细心的读者会注意到，输入中还有以 ``#`` 号开头的行或者行中包含 ``#`` 号，所有的 ``#`` 号后面的内容都是注释语句。

BDF高级输入说明如下：

+---------------------+--------------------------------------------------------------------------------------------------------------------+
| 输入内容            | 说明                                                                                                               |
+---------------------+--------------------------------------------------------------------------------------------------------------------+
| $modulename...$end  |  modulename为BDF计算模块的控制输入,所有的modulename在$BDFHOME/database/program.dat文件中查询                       |  
+---------------------+--------------------------------------------------------------------------------------------------------------------+
| #号                 | #号开始的行或者每行中#号后续的内容均为注释语句                                                                     |
+---------------------+--------------------------------------------------------------------------------------------------------------------+
| \*号                | \*号只放于行首，以*号开始的行为注释行                                                                              |
+---------------------+--------------------------------------------------------------------------------------------------------------------+
| %号                 | %号开始的行，%号后的内容为Shell命令，通常用于处理中间文件                                                          | 
+---------------------+--------------------------------------------------------------------------------------------------------------------+
| &database...&end    | 有些复杂的计算，如FLMO，需要定义分子片段等信息，这通常放于&database与&end之间。请参考 :ref:`test062<test062>`      |  
+---------------------+--------------------------------------------------------------------------------------------------------------------+



BDF的混合输入（mixed input）
--------------------------------------------------------------------------

混合输入结合了BDF的简洁输入与高级输入格式，即可享有BDF简洁输入的便利性，又可对BDF的计算模块进行精准的控制，这在执行复杂的计算时非常有用。

BDF混合输入文件的基本结构如下：

.. code-block:: bdf

  #!name.bdf
  方法/泛函/基组1[原子组]/基组2[原子组] 关键词 关键词=选项 关键词=选项1，选项2
  关键词=选项

  Geometry
  分子结构信息
  End Geometry 

  $modulename1
  ...       # 注释语句
  $End

  $modulename2
  ...
  $End


按照输入的功能，一个混合输入文件最多可分为4个输入块:

**第一输入块** 

只有一行，以”#!”开始，后面是输入脚本的名字，例如#!name.bdf

**第二输入块** 


从第二行开始，到Geometry前一行结束。这一输入块，可以由多行组成，是BDF的命令控制行，用于指定BDF做什么计算任务，采用什么方法。命令行内容以空格分开不同的关键词。
关键词及其值用等号分开，一个关键词如果没有值，关键词本身即为控制关键词。关键词可以有一个值，也可以有用逗号分开的多个值。
关键词可以有多行，如果一行中出现了#，则#后的行为注释语句。

**第三输入块** 


从Geometry行开始，到End Geometry行结束，输入分子的几何结构，具体格式见分子结构的输入格式说明。

**第四输入块** 


“End geometry”后剩余的内容为第四输入块，与BDF高级输入的格式相同，用于对具体的BDF计算模块的行为进行精确控制，这些参数被加入相应的BDF计算模块中，具有最高的控制优先级。

以水合离子为例来详细描述BDF混合输入格式：

.. code-block:: bdf

  #!H2O+.bdf
  B3lyp/3-21G iroot=4 

  Geometry
  O 0.00000    0.00000   0.36827
  H 0.00000   -0.78398   -0.18468
  H 0.00000    0.78398   -0.18468
  End Geometry

  $scf
  Charge # 指定电荷数为+1
   1
  molden # 输出分子轨道为molden格式文件
  $end

上例除了BDF简洁输入的必要内容外，还加入了以$scf开始，到$end结束的行。该输入混合了BDF简洁输入和高级输入的内容，在scf模块的输入中，加入了charge，值为1，用于计算 :math:`H_2O^+` 离子，
molden关键词控制scf将收敛后的轨道输出为molden格式文件用来作图。需要指出的是，在混合输入格式的第二行命令行，可以用 ``charge = -1`` 来控制计算 :math:`H_2O^-` 阴离子，
但若在后面的scf模块输入中，也使用了 ``charge`` 关键词，则后者具有最高的控制优先级，将覆盖命令行中的输入。换言之，在混合输入格式下，每个BDF计算模块的高级输入关键词具有最高的控制优先级。

分子结构的输入格式
==========================================================================

BDF的分子结构输入从 ``Geometry`` 开始，到 ``End geometry`` 结束，可以按照直角坐标，内坐标，或者指定xyz文件格式的三种方式输入。

.. Warning::
    BDF默认输入的坐标单位为埃(angstrom)，如果需要使用原子单位输入分子结构，需用关键词 ``unit=Bohr`` 来指定。BDF的简洁输入模式下， ``unit=Bohr`` 放在第二行控制行。 如果是高级输入模式，在Compass模块使用关键词 ``unit`` ，并指定值为Bohr。


分子结构的直角坐标格式输入
--------------------------------------------------------------------------

.. code-block:: bdf

   Geometry # default coodinate unit is angstrom 
   O  0.00000   0.00000    0.36937
   H  0.00000  -0.78398   -0.18468 
   H  0.00000   0.78398   -0.18468 
   End geometry

.. _Internal-Coord:

分子结构的内坐标格式输入 
--------------------------------------------------------------------------

内坐标采用定义键长、键角、二面角的格式输入，其中键长的单位为埃，键角和二面角的单位为度。输入模式举例如下：

.. code-block:: bdf

   Geometry
   atom1
   atom2 1   R21                  # R12为原子2、1之间键长
   atom3 1   R31  2 A312          # R31为原子3、1之间键长， A312为原子3、1、2定义的键角
   atom4 3   R43  2 A432 1 D4321  # R43为原子4、3之间键长， A432为原子4、3、2定义的键角，D4321为原子4、3、2、1定义的二面角
   atom5 3   R53  4 A534 1 D5341  # R53为原子5、3之间键长， A534为原子5、3、4定义的键角，D5341为原子5、4、3、1定义的二面角 
   ...
   ...
   End Geometry

具体的，对于水分子，内坐标输入如下：

.. code-block:: bdf
 
 Geometry
 O
 H  1   0.9
 H  1   0.9. 2.0 109.0
 End geometry

内坐标输入，利用变量定义内坐标数值如下：

.. code-block:: bdf
 
 Geometry
 O
 H  1   R1
 H  1   R1  2  A1

 R1 = 0.9
 A1 = 109.0
 End geometry

内坐标格式输入，势能面扫描如下：

例1： :math:`H_2O` 的坐标输入，势能面扫描，键长从0.75埃开始，按照0.05埃的步长，键长由小到大计算20个点。

.. code-block:: bdf
 
 Geometry
 O
 H  1   R1
 H  1   R1  2  109

 R1  0.75 0.05 20
 End geometry

例2： :math:`H_2O` 的坐标输入，势能面扫描，键长从0.75 开始，按照0.05 step，计算20个点。SCF通过Read获取初始猜测轨道。

.. code-block:: bdf

 #! h2oscan.bdf  
 B3lyp/3-21G Scan Guess=read

 Geometry
 O
 H  1   R1
 H  1   R1  2  A1

 A1 = 109.0

 R1 0.75 0.05 20
 End geometry

从指定文件中读入分子坐标
--------------------------------------------------------------------------

.. code-block:: bdf
 
 Geometry
 file=filename.xyz
 End geometry


BDF输出文件
==========================================================================


+------------------------------------+------------------------------------------------------------------------------------------+
|            文件扩展名              |     说明                                                                                 |
+====================================+==========================================================================================+
|                  .out              |           主输出文件                                                                     |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .out.tmp          |           结构优化及数值频率任务的副输出文件（包含能量、梯度等计算步骤的输出）             |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .pes1             | 结构优化及数值频率任务各步的分子结构（埃）、能量（Hartree）及梯度（Hartree/Bohr）         |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .egrad1           |           结构优化及数值频率任务最后一步的能量（Hartree）及梯度（Hartree/Bohr）           |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .hess             |                                    Hessian矩阵（Hartree/Bohr^2）                        |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .unimovib.input   |                                    UniMoVib输入文件，可用于热化学分析                    |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .nac              |                      非绝热耦合矢量（Hartree/Bohr）                                      |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .chkfil           |            临时文件                                                                      |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .datapunch        |            临时文件                                                                      |
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .optgeom          |        结构优化任务最后一步的分子坐标（Bohr）                                             |
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .finaldens        |           最后一步SCF迭代的密度矩阵                                                       | 
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .finalfock        |           最后一步SCF迭代的Fock矩阵                                                       | 
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .scforb           |           最后一步SCF迭代的分子轨道                                                       |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .global.scforb    |           FLMO/iOI计算最后一步SCF迭代的分子轨道                                           |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .fragment*.*      |           FLMO/iOI计算的子体系计算相关输出文件                                            |  
+------------------------------------+------------------------------------------------------------------------------------------+
|                  .ioienlarge.out   |           iOI计算第1步及之后的宏迭代的子体系组成信息                                      |  
+------------------------------------+------------------------------------------------------------------------------------------+

某些计算任务可能会产生以上所未列举的其他输出文件，这些文件一般为临时文件。


量子化学常用单位及换算
==========================================================================

量子化学程序大部分内部运算使用原子单位制（atomic unit, au.）。这使得各种计算公式中不需要涉及单位转换，既使得代码简洁，也避免额外的运算和精度损失。量化程序输出中间数据时一般也用原子单位制，但输出有化学意义的数据时大多还是会转换成常用的单位。

 * 能量 1 a.u. = 1 Hartree
 * 质量 1 a.u. = 1 m :sub:`e` （电子质量）
 * 长度 1 a.u. = 1 Bohr
 * 电量 1 a.u. = 1 e = 1.6022×10 :sup:`-19` C
 * 电子密度 1 a.u. = 1e/Bohr :sup:`3`
 * 偶极矩 1 a.u. = 1 e · Bohr = 0.97174×10 :sup:`22` V/m :sup:`2` = 2.5417462 Debye
 * 静电势 1 a.u. = 1 Hartree/e
 * 电场 1 a.u. = 1 Hartree/(Bohr · e) = 51421 V/Angstrom

能量单位换算
----------------------------------------------

+-------------------+---------------------+---------------------+---------------------+---------------------+-------------------+
| 1 unit =          | Hartree             | kJ·mol :sup:`-1`    | kcal·mol :sup:`-1`  |      eV             |  cm :sup:`-1`     |
+-------------------+---------------------+---------------------+---------------------+---------------------+-------------------+
| Hartree           |   1                 |    2625.50          |     627.51          |    27.212           | 2.1947×10 :sup:`5`|
+-------------------+---------------------+---------------------+---------------------+---------------------+-------------------+
| kJ·mol :sup:`-1`  | 3.8088×10 :sup:`-4` |     1               |     0.23901         | 1.0364×10 :sup:`-2` |   83.593          |
+-------------------+---------------------+---------------------+---------------------+---------------------+-------------------+
| kcal·mol :sup:`-1`| 1.5936×10 :sup:`-3` |     4.184           |     1               | 4.3363×10 :sup:`-2` |   349.75          |
+-------------------+---------------------+---------------------+---------------------+---------------------+-------------------+
|    eV             | 3.6749×10 :sup:`-2` |     96.485          |     23.061          |       1             |   8065.5          |
+-------------------+---------------------+---------------------+---------------------+---------------------+-------------------+
|    cm :sup:`-1`   | 4.5563×10 :sup:`-6` | 1.1963×10 :sup:`-2` | 2.8591×10 :sup:`-3` | 1.2398×10 :sup:`-4` |       1           |
+-------------------+---------------------+---------------------+---------------------+---------------------+-------------------+

长度单位换算
----------------------------------------------

+-------------------+---------------------+---------------------+---------------------+
| 1 unit =          | Bohr                |     Angstrom        |         nm          |
+-------------------+---------------------+---------------------+---------------------+
| Bohr              |   1                 |    0.52917720859    |     0.052917720859  |
+-------------------+---------------------+---------------------+---------------------+
| Angstrom          | 1.88972613          |     1               |     0.1             |
+-------------------+---------------------+---------------------+---------------------+
|     nm            | 0.188972613         |     10              |     1               |
+-------------------+---------------------+---------------------+---------------------+

