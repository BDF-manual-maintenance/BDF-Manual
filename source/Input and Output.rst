3.  输入输出格式说明
************************************

3.1.  BDF的输出格式
==========================================================================

BDF输入文件格式有三种，分别为：简洁输入（easy input）；高级输入（advanced input）；混合输入（mixed input）。 **简洁输入** 易用性强，用户无需对计算细节太了解，使用门槛低，面向初级用户。 **高级输入** 提供了对BDF计算强大的控制功能，对每个计算模块都可以精确控制。 **混合输入** 是在BDF简洁输入基础上，部分内容也采用高级输入格式，即BDF输入使之包含了按照高级输入格式定义具体计算模块控制参数的混合输入格式，
从而实现精确控制BDF计算模块。对于初学者，只需用BDF简洁输入即可完成大多数计算任务。对于有量子化学理论基础，想深入学习和使用BDF更高级的功能，可以学习采用BDF的高级输入。


.. note::

   **BDF输入中除了文件名、shell命令及环境变量外，其他的输入，如BDF输入关键词，输入都不区分大小写字母。**
..


3.1.1.  BDF的简洁输入(easy input)
--------------------------------------------------------------------------

以水分子的单点能计算为例来详细描述BDF简洁输入格式：

.. code-block:: python

  #!H2O.bdf
  B3lyp/3-21G 

  Geometry
  O 0.00000    0.00000   0.36827
  H 0.00000   -0.78398   -0.18468
  H 0.00000    0.78398   -0.18468
  End Geometry

- 第一行由#!开始，与Linux中脚本语言约定一样，H2O.bdf是BDF输入文件的名字
- 第二行是BDF的命令行控制行，可以由多行组成，可以用于指定计算方法，基组、泛函，电荷数，自旋多重度的等一些基本的计算控制参数，命令行内容以空格作为间隔分开不同的关键词。
- 第四行开始定义分子的坐标，从Geometry开始，到End Geometry结束。

3.1.2.  BDF的高级输入(advanced input)
--------------------------------------------------------------------------

BDF的高级输入格式是起初在开发基于高斯基函数是采用的输入格式，也是BDF各个模块精确处理输入文件的格式。在实际计算中，BDF的简洁输入文件会被翻译为BDF的高级输入格式，
存储在BDF_ΤΜPDIR指定的临时文件夹中的隐藏文件.bdfinput中。BDF的高级输入格式需要对量子化学理论有一定的了解。由于BDF将不同的计算功能尽可能的独立，编译为单独的可执行文件，
相当于一个个小工具，我们称之为BDF的计算模块，然后通过python脚本将按照计算流程一次调用不同的计算模块来完成复杂的计算任务，各模块之间通过临时文件和环境变量交换数据。
所以，每个模块都有自己的控制参数。BDF的高级输入通过 **计算模块+模块控制参数** 的方式交互完成计算。


同样，以水分子为例来详细描述BDF高级输入格式：

.. code-block:: python

  #Example for BDF advanced input
  $compass
  Title
   Water molecule, energy calculation
  Geometry
  O 0.00000    0.00000   0.36827
  H 0.00000   -0.78398   -0.18468
  H 0.00000    0.78398   -0.18468
  End geometry
  Basis
   3-21G
  Group
   C(2v)
  $end

  $xuanyuan
  $end

  $scf
  RHF
  $end

  %cp $BDF_WORKDIR/$BDFTASK.scforb $BDF_TMPDIR/inporb
  $scf
  RKS
  DFT
   B3lyp     # B3LYP functional
  Guess 
   Read     #Read orbital from inporb as the initial guess orbital
  $end

一般的，BDF高级输入包含了多个计算模块的输入，每个计算模块输入以$modulename开始，以$end结束。上面所示的输入文件包含四个计算模块，分别为compass，xuanyuan和两个scf。
compass主要用于读入输入分子坐标，基函数等信息，并存储为BDF内部的数据结构。compass的一个重要任务是对分子点群的处理，包括判断分子对称性，产生对称匹配的轨道（symmetry-adapted orbital）等。
xuanyuan用于计算单、双电子积分。然后调用两次scf执行自洽场(self-consistent field)计算，一次为RHF（Restricted Hatree-Fock），另一次为RKS(Restrickted Kohn-Sham)。


每个计算模块的输入遵循 **“关键词+值”** 的格式，即给出一个关键词，如compass中的Group，紧接着一行为该关键词的值，这里是C(2v)。有的关键词本身即用于逻辑控制，
如第一个scf模块中的RHF，指定scf模块执行RHF计算，这类关键词不需要额外的输入值。而有的关键词的值需要多行输入，具体参见各个模块的关键词说明。



在第一个和第二个scf模块之间，有一个%开头的行。这里，我们插入了一条shell命令，执行一个拷贝文件的任务。将第一个scf计算产生的放在BDF_WORKDIR中的$BDFTASK.scforb文件拷贝到BDF_TMPDIR，并更名为inporb。
在第二个scf模块中，我们指定了关键词guess，值为read，即读入分子轨道作为初始猜测。在BDF高级输入中，以%起始的行为shell命令行，
细心的读者会注意到，输入中还有以#号开头的行或者行中包含#号，所有的#号后面的内容都是注释语句。

BDF高级输入说明如下：

+--------------------+--------------------------------------------------------------------------------------------------------------------+
| 输入内容           | 说明                                                                                                               |
|                    |                                                                                                                    |
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|$modulename...$end  |  modulename为BDF计算模块的控制输入,所有的modulename在$BDFHOME/database/program.dat文件中查询                       |  
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|#号                 | #号开始的行或者每行中#号后续的内容均为注释语句                                                                     |
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|*号                 |  *号只放于行首，以*号开始的行为注释行                                                                              |
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|%号                 |  %号开始的行，%号后的内容为Shell命令，通常用于处理中间文件                                                         | 
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|&database...&end    |有些复杂的计算，如FLMO，需要定义分子片段等信息，这通常放于&database与&end之间。见$BDFHOME/tests/input/ test062.inp  |  
+--------------------+--------------------------------------------------------------------------------------------------------------------+





3.1.3.  BDF的混合输入（mixed input）
--------------------------------------------------------------------------

混合输入结合了BDF的简洁输入与高级输入格式，即可享有BDF简洁输入的便利性，又可对BDF的计算模块进行精准的控制，这在执行复杂的计算，如MCSCF，MRCI等时非常有用。

BDF混合输入文件的基本结构如下：

.. code-block:: python

  #!name.bdf
  方法/泛函/基组1[原子组]/基组2[原子组] 关键词 关键词=选项 关键词=选项1，选项2
  关键词=选项

  Geometry
  分子结构信息
  End Geometry 

  $modulename1
  ...       # 注释语句
  $End

  $modulename2
  ...
  End


按照输入的功能，一个混合输入文件最多可分为4个输入块:

**第一输入块** 

只有一行，以”#!”开始，后面是输入脚本的名字，例如#!name.bdf

**第二输入块** 


从第二行开始，到Geometry前一行结束。这一输入块，可以有多行组成，是BDF的命令控制行，用于指定BDF做什么计算任务，采用什么方法。命令行内容以空格分开不同的关键词。
关键词及其值用等号分开，一个关键词如果没有值，关键词本身即为控制关键词。关键词可以有一个值，也可以有用逗号分开的多个值。
关键词可以有多行，如果一行中出现了#，则#后的行为注释语句。

**第三输入块** 


从Geometry行开始，到End Geometry行结束，输入分子的几何结构，具体格式见分子结构的输入格式说明。

**第四输入块** 


“End geometry”后剩余的内容为第四输入块，与BDF高级输入的格式相同，用于对具体的BDF计算模块的行为进行精确控制，这些参数被加入相应的BDF计算模块中，具有最高的控制优先级。

以水合离子为例来详细描述BDF混合输入格式：

.. code-block:: python

  #!H2O+.bdf
  B3lyp/3-21G iroots=4 

  Geometry
  O 0.00000    0.00000   0.36827
  H 0.00000   -0.78398   -0.18468
  H 0.00000    0.78398   -0.18468
  End Geometry

  $scf
  Charge
   1
  molden
  $end

上例除了BDF简洁输入的必要内容外，还加入了以$scf开始，到$end结束的行。该输入混合了BDF简洁输入和高级输入的内容，在scf模块的输入中，加入了charge，值为1，用于计算H2O+离子，
molden关键词控制scf将收敛后的轨道输出为molden格式文件用来作图。需要指出的是，在混合输入格式的第二行命令行，可以用charge=-1来控制计算H2O-阴离子，
但若在后面的scf模块输入中，也使用了charge关键词，则后者具有最高的控制优先级，将覆盖命令行中的输入。换言之，在混合输入格式下，每个BDF计算模块的高级输入关键词具有最高的控制优先级。

3.2.  分子结构的输入格式
==========================================================================

BDF的分子结构输入从Geometry开始，到End geometry结束，可以按照直角坐标，内坐标，或者指定xyz文件格式的三种方式输入。


3.2.1.  直角坐标格式输入
--------------------------------------------------------------------------

.. code-block:: python

 Geometry
 O  0.00000   0.00000    0.36937
 H  0.00000  -0.78398   -0.18468 
 H  0.00000   0.78398   -0.18468 
 End geometry

3.2.2.  内坐标格式输入
--------------------------------------------------------------------------

简单的内坐标输入如下：

.. code-block:: python
 
 Geometry
 O
 H  1   0.9
 H  1   0.9. 2.0 109.0
 End geometry

内坐标输入，利用变量定义内坐标数值如下：

.. code-block:: python
 
 Geometry
 O
 H  1   R1
 H  1   R1  2  A1

 R1 = 0.9
 A1 = 109.0
 End geometry

内坐标格式输入，势能面扫描如下：

例1：H2O的坐标输入，势能面扫描，键长从0.75 开始，按照0.05 step，计算20个点。

.. code-block:: python
 
 Geometry
 O
 H  1   R1
 H  1   R1  2  109

 R1  0.75 0.05 20
 End geometry

例2：H2O的坐标输入，势能面扫描，键长从0.75 开始，按照0.05 step，计算20个点。SCF通过Read获取初始猜测轨道。

.. code-block:: python
 
 B3lyp/3-21G Scan Guess=read

 Geometry
 O
 H  1   R1
 H  1   R1  2  A1

 A1 = 109.0

 R1 0.75 0.05 20
 End geometry

3.2.3.  从指定文件中读入分子坐标
--------------------------------------------------------------------------

.. code-block:: python
 
 Geometry
 file=filename.xyz
 End geometry


3.3.  BDF输出文件格式
==========================================================================

+--------------------+-------------------------+-------------------------------------------------------------------------------------------+
|    文件后缀        |         文件格式        |     说明                                                                                  |
|                    |                         |                                                                                           |
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|.chkfil             |          二进制         |                                                                                          |  
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|.datapunch          |                         |                                                                                          |
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|.optgeom            |                         |                                                                                          |
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|.finaldens          |                         |                                                                                          | 
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|.scforb             |                         |                                                                                          |  
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|.thiophene          |                         |                                                                                          |  
+--------------------+--------------------------------------------------------------------------------------------------------------------+
|.out                |          文本           |                                                                                          |  
+--------------------+--------------------------------------------------------------------------------------------------------------------+


3.3.1.  xxx.chkfil
--------------------------------------------------------------------------

3.3.2.  xxx.datapunch
--------------------------------------------------------------------------

3.3.3.  xxx.optgeom
--------------------------------------------------------------------------

3.3.4.  xxx.finaldens
--------------------------------------------------------------------------

3.3.5.  xxx.scforb
--------------------------------------------------------------------------

3.3.6.  xxx.thiophene
--------------------------------------------------------------------------

3.3.7.  xxx.out
--------------------------------------------------------------------------


